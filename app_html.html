
<!-- saved from url=(0056)file:///C:/Users/rober/Downloads/depreciationiq_app.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head><body>(STATE, JSON.parse(s)); }
    function saveState() { localStorage.setItem('diq_state', JSON.stringify(STATE)); }
    
    // Init
    function init() {
        loadState();
        if (STATE.user) { showView('appView'); updateUserUI(); renderPage(STATE.page); }
        else { showView('loginView'); }
        
        document.getElementById('loginForm').addEventListener('submit', e =&gt; {
            e.preventDefault();
            STATE.user = { email: document.getElementById('loginEmail').value, name: document.getElementById('loginEmail').value.split('@')[0] };
            saveState(); showView('appView'); updateUserUI(); renderPage('dashboard'); toast('Welcome back!', 'success');
        });
        
        document.getElementById('signupForm').addEventListener('submit', e =&gt; {
            e.preventDefault();
            STATE.user = { email: document.getElementById('signupEmail').value, name: document.getElementById('signupFirst').value + ' ' + document.getElementById('signupLast').value };
            saveState(); showView('appView'); updateUserUI(); renderPage('dashboard'); toast('Account created!', 'success');
        });
    }
    
    function showView(id) { document.querySelectorAll('.view').forEach(v =&gt; v.classList.remove('active')); document.getElementById(id).classList.add('active'); }
    function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); }
    function login() { document.getElementById('loginForm').dispatchEvent(new Event('submit')); }
    function logout() { STATE.user = null; STATE.assets = []; saveState(); showView('loginView'); toast('Signed out'); }
    function updateUserUI() { 
        if (STATE.user) { 
            document.getElementById('userName').textContent = STATE.user.name; 
            document.getElementById('userAvatar').textContent = STATE.user.name.charAt(0).toUpperCase(); 
        }
    }
    
    function navigateTo(page) {
        STATE.page = page; saveState();
        document.querySelectorAll('.nav-item').forEach(n =&gt; n.classList.remove('active'));
        event.target.closest('.nav-item')?.classList.add('active');
        renderPage(page);
        document.getElementById('sidebar').classList.remove('open');
    }
    
    function toast(msg, type = 'success') {
        const t = document.createElement('div');
        t.className = 'toast ' + type;
        t.innerHTML = `<span>${type === 'success' ? '‚úì' : '!'}</span><span>${msg}</span>`;
        document.getElementById('toastContainer').appendChild(t);
        setTimeout(() =&gt; t.remove(), 3000);
    }
    
    function formatCurrency(n) { return '$' + (n || 0).toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 }); }
    
    // Pages
    function renderPage(page) {
        const c = document.getElementById('mainContent');
        document.getElementById('assetCount').textContent = STATE.assets.length;
        
        switch(page) {
            case 'dashboard': renderDashboard(c); break;
            case 'assets': renderAssets(c); break;
            case 'calc-179': render179(c); break;
            case 'calc-macrs': renderMACRS(c); break;
            case 'calc-vehicle': renderVehicle(c); break;
            case 'calc-realestate': renderRealEstate(c); break;
            case 'ai-chat': renderChat(c); break;
            case 'reports': renderReports(c); break;
            default: renderDashboard(c);
        }
    }
    
    function getStats() {
        const active = STATE.assets.filter(a =&gt; a.status === 'active');
        const totalValue = active.reduce((s, a) =&gt; s + (a.price * a.business / 100), 0);
        let ytdDep = 0;
        active.forEach(a =&gt; {
            const basis = a.price * a.business / 100;
            const annual = basis / (a.period || 7);
            ytdDep += annual;
        });
        return { count: active.length, value: totalValue, dep: ytdDep, savings: ytdDep * STATE.prefs.taxBracket };
    }
    
    function renderDashboard(c) {
        const s = getStats();
        c.innerHTML = `
            <div class="page-header">
                <div><h1 class="page-title">Dashboard</h1><p class="page-subtitle">Your financial command center</p></div>
                <div class="header-actions">
                    <button class="btn btn-secondary" onclick="navigateTo(&#39;reports&#39;)">üìÑ Reports</button>
                    <button class="btn btn-primary" onclick="openAssetModal()">+ Add Asset</button>
                </div>
            </div>
            <div class="stats-grid">
                <div class="stat-card"><div class="stat-header"><div class="stat-icon teal">üì¶</div></div><div class="stat-value">${s.count}</div><div class="stat-label">Total Assets</div></div>
                <div class="stat-card"><div class="stat-header"><div class="stat-icon green">üí∞</div></div><div class="stat-value">${formatCurrency(s.value)}</div><div class="stat-label">Asset Value</div></div>
                <div class="stat-card"><div class="stat-header"><div class="stat-icon purple">üìâ</div></div><div class="stat-value">${formatCurrency(s.dep)}</div><div class="stat-label">YTD Depreciation</div></div>
                <div class="stat-card"><div class="stat-header"><div class="stat-icon orange">üíµ</div></div><div class="stat-value">${formatCurrency(s.savings)}</div><div class="stat-label">Tax Savings</div></div>
            </div>
            <div class="quick-actions">
                <div class="quick-action" onclick="openAssetModal()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M12 8v8M8 12h8"></path></svg><div class="title">Add Asset</div><div class="desc">Track new asset</div></div>
                <div class="quick-action" onclick="navigateTo(&#39;calc-179&#39;)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg><div class="title">Section 179</div><div class="desc">Max deduction</div></div>
                <div class="quick-action" onclick="navigateTo(&#39;ai-chat&#39;)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg><div class="title">AI Advisor</div><div class="desc">Tax strategy</div></div>
                <div class="quick-action" onclick="navigateTo(&#39;reports&#39;)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path></svg><div class="title">Reports</div><div class="desc">PDF schedules</div></div>
            </div>
            <div class="content-grid">
                <div class="card">
                    <div class="card-header"><h3 class="card-title">Recent Assets</h3><span style="color:var(--teal-400);cursor:pointer" onclick="navigateTo(&#39;assets&#39;)">View All ‚Üí</span></div>
                    <div class="card-body np">
                        ${s.count === 0 ? `<div class="empty-state"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2"></rect><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path></svg><h3>No assets yet</h3><p>Add your first asset to start tracking</p><button class="btn btn-primary" onclick="openAssetModal()">+ Add Asset</button></div>` 
                        : STATE.assets.slice(0, 4).map(a =&gt; assetRow(a)).join('')}
                    </div>
                </div>
                <div class="card">
                    <div class="card-header"><h3 class="card-title">Tax Alerts</h3></div>
                    <div class="card-body">
                        <div class="alert-list">
                            <div class="alert-item" onclick="navigateTo(&#39;calc-179&#39;)"><div class="alert-icon urgent">‚ö†Ô∏è</div><div><div class="alert-title">Section 179 Deadline</div><div class="alert-desc">Year-end approaching</div></div><div class="alert-time">Dec 31</div></div>
                            <div class="alert-item" onclick="navigateTo(&#39;calc-179&#39;)"><div class="alert-icon warning">üìà</div><div><div class="alert-title">Bonus Depreciation</div><div class="alert-desc">60% ‚Üí 40% in 2025</div></div><div class="alert-time">Jan 1</div></div>
                            <div class="alert-item" onclick="navigateTo(&#39;ai-chat&#39;)"><div class="alert-icon info">üí°</div><div><div class="alert-title">Heavy Vehicle Strategy</div><div class="alert-desc">Ask AI about 6,000 lb rule</div></div><div class="alert-time">Tip</div></div>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }
    
    function assetRow(a) {
        const icons = { vehicle: 'üöó', equipment: 'üíª', furniture: 'ü™ë', realestate: 'üè†', other: 'üì¶' };
        const basis = a.price * a.business / 100;
        const years = Math.max(1, new Date().getFullYear() - new Date(a.date).getFullYear() + 1);
        const pct = Math.min(100, (years / (a.period || 7)) * 100);
        return `<div class="asset-row" onclick="openAssetModal(&#39;${a.id}&#39;)">
            <div class="asset-info"><div class="asset-icon">${icons[a.type] || 'üì¶'}</div><div><div class="asset-name">${a.name}</div><div class="asset-type">${a.type} ‚Ä¢ ${a.business}%</div></div></div>
            <div class="asset-value">${formatCurrency(basis)}</div>
            <div><div class="dep-bar"><div class="dep-fill" style="width:${pct}%"></div></div><div style="font-size:12px;color:var(--gray-500);margin-top:4px">${pct.toFixed(0)}%</div></div>
            <div><span class="status-badge ${a.status}">${a.status}</span></div>
        </div>`;
    }
    
    function renderAssets(c) {
        const icons = { vehicle: 'üöó', equipment: 'üíª', furniture: 'ü™ë', realestate: 'üè†', other: 'üì¶' };
        c.innerHTML = `
            <div class="page-header"><div><h1 class="page-title">Asset Vault</h1><p class="page-subtitle">All your depreciable assets</p></div><div class="header-actions"><button class="btn btn-primary" onclick="openAssetModal()">+ Add Asset</button></div></div>
            <div class="search-bar">
                <input type="text" class="search-input" id="searchInput" placeholder="Search assets..." oninput="filterAssets()">
                <select class="filter-select" id="typeFilter" onchange="filterAssets()"><option value="">All Types</option><option value="vehicle">Vehicles</option><option value="equipment">Equipment</option><option value="furniture">Furniture</option><option value="realestate">Real Estate</option><option value="other">Other</option></select>
            </div>
            <div class="card"><div class="card-body np">
                ${STATE.assets.length === 0 ? `<div class="empty-state"><h3>No assets yet</h3><p>Add your first asset</p><button class="btn btn-primary" onclick="openAssetModal()">+ Add Asset</button></div>` : `
                <div class="asset-header"><div>Asset</div><div>Value</div><div>Depreciated</div><div>Status</div></div>
                <div id="assetList">${STATE.assets.map(a =&gt; assetRow(a)).join('')}</div>`}
            </div></div>
        `;
    }
    
    function filterAssets() {
        const search = document.getElementById('searchInput').value.toLowerCase();
        const type = document.getElementById('typeFilter').value;
        document.querySelectorAll('#assetList .asset-row').forEach(r =&gt; {
            const name = r.querySelector('.asset-name').textContent.toLowerCase();
            const aType = r.querySelector('.asset-type').textContent.toLowerCase();
            const matchSearch = name.includes(search);
            const matchType = !type || aType.includes(type);
            r.style.display = matchSearch &amp;&amp; matchType ? 'grid' : 'none';
        });
    }
    
    // Asset Modal
    let editId = null;
    function openAssetModal(id = null) {
        editId = id;
        const m = document.getElementById('assetModal');
        document.getElementById('assetForm').reset();
        document.getElementById('assetDate').value = new Date().toISOString().split('T')[0];
        
        if (id) {
            const a = STATE.assets.find(x =&gt; x.id === id);
            if (a) {
                document.getElementById('assetModalTitle').textContent = 'Edit Asset';
                document.getElementById('deleteBtn').classList.remove('hidden');
                document.getElementById('assetType').value = a.type;
                document.getElementById('assetStatus').value = a.status;
                document.getElementById('assetName').value = a.name;
                document.getElementById('assetDate').value = a.date;
                document.getElementById('assetPrice').value = a.price;
                document.getElementById('assetBusiness').value = a.business;
                document.getElementById('assetPeriod').value = a.period;
            }
        } else {
            document.getElementById('assetModalTitle').textContent = 'Add Asset';
            document.getElementById('deleteBtn').classList.add('hidden');
        }
        m.classList.add('active');
    }
    
    function closeModal(id) { document.getElementById(id).classList.remove('active'); editId = null; }
    
    function saveAsset() {
        const f = document.getElementById('assetForm');
        if (!f.checkValidity()) { f.reportValidity(); return; }
        
        const data = {
            id: editId || Date.now().toString(),
            type: document.getElementById('assetType').value,
            status: document.getElementById('assetStatus').value,
            name: document.getElementById('assetName').value,
            date: document.getElementById('assetDate').value,
            price: parseFloat(document.getElementById('assetPrice').value),
            business: parseFloat(document.getElementById('assetBusiness').value) || 100,
            period: parseFloat(document.getElementById('assetPeriod').value) || 7
        };
        
        if (editId) {
            const idx = STATE.assets.findIndex(a =&gt; a.id === editId);
            if (idx &gt; -1) STATE.assets[idx] = data;
            toast('Asset updated');
        } else {
            STATE.assets.push(data);
            toast('Asset added');
        }
        
        saveState(); closeModal('assetModal'); renderPage(STATE.page);
    }
    
    function deleteAsset() {
        if (editId) {
            STATE.assets = STATE.assets.filter(a =&gt; a.id !== editId);
            saveState(); toast('Asset deleted');
        }
        closeModal('assetModal'); renderPage(STATE.page);
    }
    
    // Calculators
    function render179(c) {
        c.innerHTML = `
            <div class="page-header"><div><h1 class="page-title">Section 179 Calculator</h1><p class="page-subtitle">2024 limit: $1,220,000</p></div></div>
            <div class="calc-layout">
                <div class="calc-form">
                    <h3 class="calc-title">üí∞ Calculate Deduction</h3>
                    <div class="calc-grid">
                        <div class="form-group full"><label class="form-label">Equipment Cost ($)</label><input type="number" class="form-input" id="s179Cost" value="75000" onchange="calc179()"></div>
                        <div class="form-group"><label class="form-label">Business Income ($)</label><input type="number" class="form-input" id="s179Income" value="200000" onchange="calc179()"></div>
                        <div class="form-group"><label class="form-label">Tax Bracket</label><select class="form-select" id="s179Bracket" onchange="calc179()"><option value="0.22">22%</option><option value="0.24" selected="">24%</option><option value="0.32">32%</option><option value="0.35">35%</option><option value="0.37">37%</option></select></div>
                        <div class="form-group"><label class="form-label">Business Use %</label><input type="number" class="form-input" id="s179Business" value="100" onchange="calc179()"></div>
                        <div class="form-group"><label class="form-label">Use Bonus Depreciation?</label><select class="form-select" id="s179Bonus" onchange="calc179()"><option value="1">Yes (60% in 2024)</option><option value="0">No</option></select></div>
                    </div>
                    <div style="margin-top:24px;padding:16px;background:var(--navy-700);border-radius:12px">
                        <h4 style="font-size:14px;margin-bottom:8px">2024 Limits</h4>
                        <p style="font-size:13px;color:var(--gray-400)">‚Ä¢ Max deduction: <strong style="color:var(--teal-400)">$1,220,000</strong></p>
                        <p style="font-size:13px;color:var(--gray-400)">‚Ä¢ Phase-out at: <strong style="color:var(--teal-400)">$3,050,000</strong></p>
                        <p style="font-size:13px;color:var(--gray-400)">‚Ä¢ SUV limit: <strong style="color:var(--teal-400)">$30,500</strong></p>
                    </div>
                </div>
                <div class="calc-results"><h3 class="calc-title">üìä Results</h3><div id="s179Results"></div></div>
            </div>
        `;
        calc179();
    }
    
    function calc179() {
        const cost = parseFloat(document.getElementById('s179Cost')?.value) || 75000;
        const income = parseFloat(document.getElementById('s179Income')?.value) || 200000;
        const bracket = parseFloat(document.getElementById('s179Bracket')?.value) || 0.24;
        const business = (parseFloat(document.getElementById('s179Business')?.value) || 100) / 100;
        const useBonus = document.getElementById('s179Bonus')?.value === '1';
        
        const basis = cost * business;
        const s179 = Math.min(basis, 1220000, income);
        const bonus = useBonus ? (basis - s179) * 0.60 : 0;
        const total = s179 + bonus;
        const savings = total * bracket;
        
        document.getElementById('s179Results').innerHTML = `
            <div class="result-item"><div class="result-label">Section 179 Deduction</div><div class="result-value teal">${formatCurrency(s179)}</div></div>
            ${useBonus ? `<div class="result-item"><div class="result-label">Bonus Depreciation (60%)</div><div class="result-value">${formatCurrency(bonus)}</div></div>` : ''}
            <div class="result-item"><div class="result-label">Total Year 1 Deduction</div><div class="result-value">${formatCurrency(total)}</div></div>
            <div class="result-item"><div class="result-label">Tax Savings</div><div class="result-value green">${formatCurrency(savings)}</div></div>
            <div class="result-item"><div class="result-label">Effective Cost</div><div class="result-value">${formatCurrency(cost - savings)}</div></div>
        `;
    }
    
    function renderMACRS(c) {
        c.innerHTML = `
            <div class="page-header"><div><h1 class="page-title">MACRS Calculator</h1><p class="page-subtitle">Modified Accelerated Cost Recovery</p></div></div>
            <div class="calc-layout">
                <div class="calc-form">
                    <h3 class="calc-title">üìä Asset Details</h3>
                    <div class="calc-grid">
                        <div class="form-group full"><label class="form-label">Cost Basis ($)</label><input type="number" class="form-input" id="macrsCost" value="50000" onchange="calcMACRS()"></div>
                        <div class="form-group"><label class="form-label">Recovery Period</label><select class="form-select" id="macrsPeriod" onchange="calcMACRS()"><option value="5">5 Years</option><option value="7" selected="">7 Years</option><option value="15">15 Years</option><option value="27.5">27.5 Years</option><option value="39">39 Years</option></select></div>
                        <div class="form-group"><label class="form-label">Tax Bracket</label><select class="form-select" id="macrsBracket" onchange="calcMACRS()"><option value="0.24" selected="">24%</option><option value="0.32">32%</option><option value="0.35">35%</option></select></div>
                    </div>
                </div>
                <div class="calc-results"><h3 class="calc-title">üìà Results</h3><div id="macrsResults"></div></div>
            </div>
            <div class="card" style="margin-top:32px"><div class="card-header"><h3 class="card-title">Depreciation Schedule</h3></div><div class="card-body"><table class="schedule-table"><thead><tr><th>Year</th><th>Rate</th><th>Depreciation</th><th>Tax Savings</th></tr></thead><tbody id="macrsSchedule"></tbody></table></div></div>
        `;
        calcMACRS();
    }
    
    function calcMACRS() {
        const cost = parseFloat(document.getElementById('macrsCost')?.value) || 50000;
        const period = parseFloat(document.getElementById('macrsPeriod')?.value) || 7;
        const bracket = parseFloat(document.getElementById('macrsBracket')?.value) || 0.24;
        
        const rates = {
            5: [0.20, 0.32, 0.192, 0.1152, 0.1152, 0.0576],
            7: [0.1429, 0.2449, 0.1749, 0.1249, 0.0893, 0.0892, 0.0893, 0.0446],
            15: [0.05, 0.095, 0.0855, 0.077, 0.0693, 0.0623, 0.059, 0.059, 0.0591, 0.059, 0.0591, 0.059, 0.0591, 0.059, 0.0591, 0.0295],
            27.5: Array(28).fill(1/27.5),
            39: Array(40).fill(1/39)
        };
        
        const r = rates[period] || rates[7];
        const y1 = cost * r[0];
        
        document.getElementById('macrsResults').innerHTML = `
            <div class="result-item"><div class="result-label">Year 1 Depreciation</div><div class="result-value teal">${formatCurrency(y1)}</div></div>
            <div class="result-item"><div class="result-label">Year 1 Tax Savings</div><div class="result-value green">${formatCurrency(y1 * bracket)}</div></div>
            <div class="result-item"><div class="result-label">Total Depreciation</div><div class="result-value">${formatCurrency(cost)}</div></div>
            <div class="result-item"><div class="result-label">Recovery Period</div><div class="result-value">${period} Years</div></div>
        `;
        
        let html = '';
        r.forEach((rate, i) =&gt; {
            const dep = cost * rate;
            html += `Year ${i+1}${(rate*100).toFixed(2)}%${formatCurrency(dep)}${formatCurrency(dep * bracket)}`;
        });
        document.getElementById('macrsSchedule').innerHTML = html;
    }
    
    function renderVehicle(c) {
        c.innerHTML = `
            <div class="page-header"><div><h1 class="page-title">Vehicle Calculator</h1><p class="page-subtitle">Cars, trucks, and SUVs</p></div></div>
            <div class="calc-layout">
                <div class="calc-form">
                    <h3 class="calc-title">üöó Vehicle Details</h3>
                    <div class="calc-grid">
                        <div class="form-group"><label class="form-label">Vehicle Type</label><select class="form-select" id="vehType" onchange="calcVehicle()"><option value="car">Car (under 6,000 lbs)</option><option value="heavy">Heavy SUV/Truck (6,000+ lbs)</option></select></div>
                        <div class="form-group"><label class="form-label">Purchase Price ($)</label><input type="number" class="form-input" id="vehPrice" value="55000" onchange="calcVehicle()"></div>
                        <div class="form-group"><label class="form-label">Business Use %</label><input type="number" class="form-input" id="vehBusiness" value="100" onchange="calcVehicle()"></div>
                        <div class="form-group"><label class="form-label">Tax Bracket</label><select class="form-select" id="vehBracket" onchange="calcVehicle()"><option value="0.24" selected="">24%</option><option value="0.32">32%</option><option value="0.35">35%</option></select></div>
                    </div>
                    <div style="margin-top:24px;padding:16px;background:var(--navy-700);border-radius:12px">
                        <h4 style="font-size:14px;margin-bottom:8px">üöõ Heavy Vehicle Advantage</h4>
                        <p style="font-size:13px;color:var(--gray-400)">Vehicles over 6,000 lbs GVWR bypass passenger auto limits. Full Section 179 up to $30,500 for SUVs, plus 60% bonus on the rest!</p>
                    </div>
                </div>
                <div class="calc-results"><h3 class="calc-title">üìä Results</h3><div id="vehResults"></div></div>
            </div>
        `;
        calcVehicle();
    }
    
    function calcVehicle() {
        const type = document.getElementById('vehType')?.value || 'car';
        const price = parseFloat(document.getElementById('vehPrice')?.value) || 55000;
        const business = (parseFloat(document.getElementById('vehBusiness')?.value) || 100) / 100;
        const bracket = parseFloat(document.getElementById('vehBracket')?.value) || 0.24;
        
        const basis = price * business;
        let y1, strategy;
        
        if (type === 'heavy') {
            const s179 = Math.min(basis, 30500);
            const bonus = (basis - s179) * 0.60;
            y1 = s179 + bonus;
            strategy = `Section 179 (${formatCurrency(s179)}) + Bonus (${formatCurrency(bonus)})`;
        } else {
            y1 = Math.min(basis, 20200);
            strategy = 'Limited by passenger auto rules';
        }
        
        const savings = y1 * bracket;
        
        document.getElementById('vehResults').innerHTML = `
            <div class="result-item"><div class="result-label">Year 1 Deduction</div><div class="result-value teal">${formatCurrency(y1)}</div></div>
            <div class="result-item"><div class="result-label">Tax Savings</div><div class="result-value green">${formatCurrency(savings)}</div></div>
            <div class="result-item"><div class="result-label">Effective Cost</div><div class="result-value">${formatCurrency(price - savings)}</div></div>
            <div class="result-item"><div class="result-label">Strategy</div><div class="result-sub">${strategy}</div></div>
            ${type === 'heavy' ? `<div style="margin-top:16px;padding:16px;background:var(--teal-glow);border-radius:12px"><p style="font-size:14px;color:var(--teal-400);font-weight:600">‚úì Heavy Vehicle Qualified</p><p style="font-size:13px;color:var(--gray-300);margin-top:8px">This vehicle bypasses the $20,200 passenger auto limit!</p></div>` : ''}
        `;
    }
    
    function renderRealEstate(c) {
        c.innerHTML = `
            <div class="page-header"><div><h1 class="page-title">Real Estate Calculator</h1><p class="page-subtitle">Rental and commercial property</p></div></div>
            <div class="calc-layout">
                <div class="calc-form">
                    <h3 class="calc-title">üè† Property Details</h3>
                    <div class="calc-grid">
                        <div class="form-group"><label class="form-label">Property Type</label><select class="form-select" id="reType" onchange="calcRE()"><option value="residential">Residential (27.5 yrs)</option><option value="commercial">Commercial (39 yrs)</option></select></div>
                        <div class="form-group"><label class="form-label">Purchase Price ($)</label><input type="number" class="form-input" id="rePrice" value="450000" onchange="calcRE()"></div>
                        <div class="form-group"><label class="form-label">Land Value ($)</label><input type="number" class="form-input" id="reLand" value="100000" onchange="calcRE()"></div>
                        <div class="form-group"><label class="form-label">Tax Bracket</label><select class="form-select" id="reBracket" onchange="calcRE()"><option value="0.24" selected="">24%</option><option value="0.32">32%</option><option value="0.35">35%</option></select></div>
                    </div>
                    <div style="margin-top:24px;padding:16px;background:var(--navy-700);border-radius:12px">
                        <h4 style="font-size:14px;margin-bottom:8px">üí° Cost Segregation</h4>
                        <p style="font-size:13px;color:var(--gray-400)">For properties over $500K, a cost seg study can accelerate $50K+ in depreciation by reclassifying components to 5, 7, or 15-year property.</p>
                    </div>
                </div>
                <div class="calc-results"><h3 class="calc-title">üìä Results</h3><div id="reResults"></div></div>
            </div>
        `;
        calcRE();
    }
    
    function calcRE() {
        const type = document.getElementById('reType')?.value || 'residential';
        const price = parseFloat(document.getElementById('rePrice')?.value) || 450000;
        const land = parseFloat(document.getElementById('reLand')?.value) || 100000;
        const bracket = parseFloat(document.getElementById('reBracket')?.value) || 0.24;
        
        const basis = price - land;
        const years = type === 'residential' ? 27.5 : 39;
        const annual = basis / years;
        const monthly = annual / 12;
        
        document.getElementById('reResults').innerHTML = `
            <div class="result-item"><div class="result-label">Depreciable Basis</div><div class="result-value">${formatCurrency(basis)}</div><div class="result-sub">Price minus land</div></div>
            <div class="result-item"><div class="result-label">Annual Depreciation</div><div class="result-value teal">${formatCurrency(annual)}</div></div>
            <div class="result-item"><div class="result-label">Monthly Depreciation</div><div class="result-value">${formatCurrency(monthly)}</div></div>
            <div class="result-item"><div class="result-label">Annual Tax Savings</div><div class="result-value green">${formatCurrency(annual * bracket)}</div></div>
            <div class="result-item"><div class="result-label">Recovery Period</div><div class="result-value">${years} Years</div></div>
        `;
    }
    
    // AI Chat
    function renderChat(c) {
        c.innerHTML = `
            <div class="page-header"><div><h1 class="page-title">AI Tax Advisor</h1><p class="page-subtitle">Ask about depreciation and tax strategy</p></div><button class="btn btn-secondary btn-sm" onclick="configureAPI()">‚öôÔ∏è Configure API</button></div>
            <div class="card" style="height:calc(100vh - 180px);display:flex;flex-direction:column">
                <div class="chat-messages" id="chatMessages">
                    ${STATE.chatHistory.length === 0 ? `
                    <div class="chat-message assistant">
                        <div class="chat-avatar">AI</div>
                        <div class="chat-bubble">üëã Hi! I'm your AI Tax Advisor. Ask me about:<br><br>‚Ä¢ Section 179 deductions<br>‚Ä¢ Bonus depreciation strategies<br>‚Ä¢ Vehicle depreciation (heavy SUV trick!)<br>‚Ä¢ Real estate depreciation<br>‚Ä¢ Cost segregation<br><br>What would you like to know?</div>
                    </div>` : STATE.chatHistory.map(m =&gt; `<div class="chat-message ${m.role}"><div class="chat-avatar">${m.role === 'user' ? STATE.user?.name?.charAt(0) || 'U' : 'AI'}</div><div class="chat-bubble">${m.content}</div></div>`).join('')}
                </div>
                <div class="chat-input-container">
                    <textarea class="chat-input" id="chatInput" placeholder="Ask about depreciation, Section 179, vehicles..." rows="1" onkeydown="if(event.key===&#39;Enter&#39;&amp;&amp;!event.shiftKey){event.preventDefault();sendChat()}"></textarea>
                    <button class="btn btn-primary" onclick="sendChat()">Send</button>
                </div>
            </div>
        `;
    }
    
    async function sendChat() {
        const input = document.getElementById('chatInput');
        const msg = input.value.trim();
        if (!msg) return;
        
        input.value = '';
        STATE.chatHistory.push({ role: 'user', content: msg });
        saveState();
        
        const messages = document.getElementById('chatMessages');
        messages.innerHTML += `<div class="chat-message user"><div class="chat-avatar">${STATE.user?.name?.charAt(0) || 'U'}</div><div class="chat-bubble">${msg}</div></div>`;
        messages.innerHTML += `<div class="chat-message assistant" id="typing"><div class="chat-avatar">AI</div><div class="chat-bubble">Thinking...</div></div>`;
        messages.scrollTop = messages.scrollHeight;
        
        let response;
        if (STATE.apiKey) {
            try {
                const res = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'x-api-key': STATE.apiKey, 'anthropic-version': '2023-06-01', 'anthropic-dangerous-direct-browser-access': 'true' },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 1024,
                        system: `You are DepreciationIQ's AI Tax Advisor. Expert in Section 179 (2024 limit $1,220,000), bonus depreciation (60% in 2024), MACRS, vehicle depreciation, and real estate. Give specific numbers and actionable advice. Be concise but thorough.`,
                        messages: STATE.chatHistory.map(m =&gt; ({ role: m.role === 'user' ? 'user' : 'assistant', content: m.content }))
                    })
                });
                const data = await res.json();
                response = data.content?.[0]?.text || 'Sorry, I encountered an error.';
            } catch (e) {
                response = 'Error connecting to AI. Please check your API key.';
            }
        } else {
            // Fallback responses
            const lower = msg.toLowerCase();
            if (lower.includes('179')) response = "**Section 179 (2024)**\n\n‚Ä¢ Max deduction: $1,220,000\n‚Ä¢ Phase-out starts at $3,050,000\n‚Ä¢ SUV limit: $30,500\n\nThis lets you expense the full cost of qualifying equipment in Year 1 instead of depreciating over time. Must have enough business income to claim it.\n\n**Pro tip:** Combine with 60% bonus depreciation on amounts over the 179 limit!";
            else if (lower.includes('vehicle') || lower.includes('car') || lower.includes('truck')) response = "**Vehicle Depreciation Strategy**\n\n**Standard cars (&lt;6,000 lbs):**\n‚Ä¢ Year 1 limit (with bonus): $20,200\n‚Ä¢ Year 2: $19,500\n‚Ä¢ Year 3: $11,700\n\n**Heavy vehicles (6,000+ lbs GVWR):**\n‚Ä¢ Full Section 179 up to $30,500\n‚Ä¢ Plus 60% bonus on the rest!\n\n**The Play:** Buy an F-150, Silverado, or large SUV over 6,000 lbs. A $55,000 truck could get you $45,000+ in Year 1 deductions!";
            else if (lower.includes('bonus')) response = "**Bonus Depreciation Phase-Down**\n\n‚Ä¢ 2024: **60%**\n‚Ä¢ 2025: 40%\n‚Ä¢ 2026: 20%\n‚Ä¢ 2027: 0%\n\n**Action:** If you're buying equipment, accelerate purchases while rates are higher. The difference between 60% and 40% on a $100K asset is $20,000 in Year 1 deductions!";
            else if (lower.includes('real estate') || lower.includes('rental')) response = "**Real Estate Depreciation**\n\n‚Ä¢ Residential rental: 27.5 years (3.636%/year)\n‚Ä¢ Commercial: 39 years (2.564%/year)\n‚Ä¢ Land is NOT depreciable\n\n**Cost Segregation:** For properties over $500K, a study can reclassify 15-30% of the building to 5, 7, or 15-year property, accelerating $50K-$100K+ in deductions!\n\n**Example:** $500K rental, $100K land = $400K basis. That's $14,545/year or $3,490 tax savings at 24% bracket.";
            else response = "I can help with:\n\n‚Ä¢ **Section 179** - Max first-year deductions\n‚Ä¢ **Bonus Depreciation** - 60% in 2024, dropping to 40%\n‚Ä¢ **Vehicle Strategy** - Heavy SUV/truck loophole\n‚Ä¢ **MACRS** - Standard depreciation schedules\n‚Ä¢ **Real Estate** - Rental and commercial property\n‚Ä¢ **Cost Segregation** - Accelerating RE depreciation\n\nWhat would you like to know more about?";
        }
        
        document.getElementById('typing').remove();
        STATE.chatHistory.push({ role: 'assistant', content: response });
        saveState();
        
        messages.innerHTML += `<div class="chat-message assistant"><div class="chat-avatar">AI</div><div class="chat-bubble">${response.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')}</div></div>`;
        messages.scrollTop = messages.scrollHeight;
    }
    
    function configureAPI() {
        const key = prompt('Enter your Anthropic API key (get one at console.anthropic.com):', STATE.apiKey);
        if (key !== null) { STATE.apiKey = key; saveState(); toast('API key saved'); }
    }
    
    // Reports
    function renderReports(c) {
        c.innerHTML = `
            <div class="page-header"><div><h1 class="page-title">Reports</h1><p class="page-subtitle">Generate PDF depreciation schedules</p></div></div>
            <div class="stats-grid" style="grid-template-columns:repeat(3,1fr)">
                <div class="quick-action" onclick="generateReport(&#39;summary&#39;)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path></svg><div class="title">Asset Summary</div><div class="desc">All assets overview</div></div>
                <div class="quick-action" onclick="generateReport(&#39;schedule&#39;)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"></rect><path d="M16 2v4M8 2v4M3 10h18"></path></svg><div class="title">Depreciation Schedule</div><div class="desc">Year-by-year breakdown</div></div>
                <div class="quick-action" onclick="generateReport(&#39;tax&#39;)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg><div class="title">Tax Savings Report</div><div class="desc">Deductions &amp; savings</div></div>
            </div>
            <div class="card">
                <div class="card-header"><h3 class="card-title">Recent Reports</h3></div>
                <div class="card-body">
                    <div class="empty-state"><h3>Generate your first report</h3><p>Click any report type above to create a PDF</p></div>
                </div>
            </div>
        `;
    }
    
    function generateReport(type) {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        const s = getStats();
        
        doc.setFontSize(22);
        doc.setTextColor(45, 212, 191);
        doc.text('DepreciationIQ', 20, 25);
        
        doc.setFontSize(16);
        doc.setTextColor(0);
        doc.text(type === 'summary' ? 'Asset Summary Report' : type === 'schedule' ? 'Depreciation Schedule' : 'Tax Savings Report', 20, 40);
        
        doc.setFontSize(10);
        doc.setTextColor(100);
        doc.text(`Generated: ${new Date().toLocaleDateString()}`, 20, 50);
        
        doc.setFontSize(12);
        doc.setTextColor(0);
        let y = 70;
        
        doc.text(`Total Assets: ${s.count}`, 20, y); y += 10;
        doc.text(`Total Value: ${formatCurrency(s.value)}`, 20, y); y += 10;
        doc.text(`YTD Depreciation: ${formatCurrency(s.dep)}`, 20, y); y += 10;
        doc.text(`Estimated Tax Savings: ${formatCurrency(s.savings)}`, 20, y); y += 20;
        
        if (STATE.assets.length &gt; 0) {
            doc.setFontSize(14);
            doc.text('Assets:', 20, y); y += 10;
            doc.setFontSize(10);
            
            STATE.assets.forEach(a =&gt; {
                const basis = a.price * a.business / 100;
                doc.text(`‚Ä¢ ${a.name} - ${formatCurrency(basis)} (${a.period} yr)`, 25, y);
                y += 8;
                if (y &gt; 270) { doc.addPage(); y = 20; }
            });
        }
        
        doc.save(`DepreciationIQ_${type}_${new Date().toISOString().split('T')[0]}.pdf`);
        toast('Report downloaded!');
    }
    
    // Init
    init();
    


</body></html>