<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DepreciationIQ - Keep More of What You Earn</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
:root{--navy-900:#0A1628;--navy-800:#0F2140;--navy-700:#162D54;--navy-600:#1E3A68;--teal-400:#2DD4BF;--teal-500:#14B8A6;--teal-600:#0D9488;--teal-glow:rgba(45,212,191,0.15);--white:#FFFFFF;--gray-300:#CBD5E1;--gray-400:#94A3B8;--gray-500:#64748B;--green-400:#4ADE80;--green-500:#22C55E;--red-400:#F87171;--red-500:#EF4444;--yellow-400:#FACC15;--purple-400:#C084FC;--orange-400:#FB923C}
*{margin:0;padding:0;box-sizing:border-box}body{font-family:'DM Sans',sans-serif;background:var(--navy-900);color:var(--white);min-height:100vh}.hidden{display:none!important}.view{display:none}.view.active{display:block}
.form-group{display:flex;flex-direction:column;gap:8px;margin-bottom:20px}.form-label{font-size:14px;font-weight:600;color:var(--gray-300)}.form-input,.form-select{width:100%;background:var(--navy-700);border:1px solid var(--navy-600);border-radius:10px;padding:14px 16px;color:var(--white);font-size:15px;font-family:inherit}.form-input:focus,.form-select:focus{outline:none;border-color:var(--teal-400);box-shadow:0 0 0 3px var(--teal-glow)}.form-input::placeholder{color:var(--gray-500)}.form-row{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:14px 24px;border-radius:10px;font-size:15px;font-weight:600;cursor:pointer;transition:all 0.2s;border:none;font-family:inherit}.btn-primary{background:linear-gradient(135deg,var(--teal-400),var(--teal-600));color:var(--navy-900)}.btn-primary:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(45,212,191,0.35)}.btn-secondary{background:var(--navy-700);color:var(--white);border:1px solid var(--navy-600)}.btn-secondary:hover{background:var(--navy-600)}.btn-ghost{background:transparent;color:var(--gray-400)}.btn-ghost:hover{color:var(--teal-400)}.btn-full{width:100%}.btn-lg{padding:18px 32px;font-size:16px}
.auth-container{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px;background:radial-gradient(ellipse 80% 50% at 50% -20%,rgba(45,212,191,0.12),transparent),var(--navy-900)}.auth-card{width:100%;max-width:480px;background:var(--navy-800);border:1px solid var(--navy-600);border-radius:20px;padding:48px 40px;position:relative}.auth-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--teal-400),var(--teal-600));border-radius:20px 20px 0 0}.logo{display:flex;align-items:center;gap:12px;justify-content:center;margin-bottom:32px}.logo svg{width:44px;height:44px}.logo-text{font-size:24px;font-weight:700}.logo-text span{color:var(--teal-400)}.auth-title{font-size:28px;font-weight:700;text-align:center;margin-bottom:8px}.auth-subtitle{text-align:center;color:var(--gray-400);margin-bottom:32px}.auth-footer{text-align:center;margin-top:24px;font-size:14px;color:var(--gray-400)}.auth-footer a{color:var(--teal-400);text-decoration:none;font-weight:500;cursor:pointer}
.onboarding-container{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px;background:radial-gradient(ellipse 80% 50% at 50% -20%,rgba(45,212,191,0.12),transparent),var(--navy-900)}.onboarding-card{width:100%;max-width:640px;background:var(--navy-800);border:1px solid var(--navy-600);border-radius:20px;padding:48px}.onboarding-progress{display:flex;gap:8px;margin-bottom:32px}.progress-step{flex:1;height:4px;background:var(--navy-600);border-radius:2px}.progress-step.active{background:var(--teal-400)}.progress-step.complete{background:var(--green-500)}.onboarding-title{font-size:24px;font-weight:700;margin-bottom:8px}.onboarding-subtitle{color:var(--gray-400);margin-bottom:32px}.onboarding-nav{display:flex;justify-content:space-between;margin-top:32px}
.app-layout{display:flex;min-height:100vh}.sidebar{width:280px;background:var(--navy-800);border-right:1px solid var(--navy-600);padding:24px 16px;position:fixed;height:100vh;overflow-y:auto;display:flex;flex-direction:column;z-index:100}.sidebar-logo{display:flex;align-items:center;gap:12px;padding:0 12px;margin-bottom:32px}.sidebar-logo .logo-text{font-size:20px}.nav-section{margin-bottom:24px}.nav-label{font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:0.05em;color:var(--gray-500);padding:0 12px;margin-bottom:8px}.nav-item{display:flex;align-items:center;gap:12px;padding:12px;border-radius:10px;cursor:pointer;transition:all 0.2s;font-size:14px;font-weight:500;color:var(--gray-400);margin-bottom:2px}.nav-item:hover{background:var(--navy-700);color:var(--white)}.nav-item.active{background:var(--teal-glow);color:var(--teal-400)}.nav-item svg{width:20px;height:20px;flex-shrink:0}.nav-badge{margin-left:auto;background:var(--teal-500);color:var(--navy-900);font-size:11px;font-weight:700;padding:2px 8px;border-radius:10px}.nav-badge.hot{background:var(--orange-400)}.nav-badge.new{background:var(--purple-400)}.sidebar-footer{margin-top:auto;padding-top:20px;border-top:1px solid var(--navy-600)}.user-card{display:flex;align-items:center;gap:12px;padding:12px}.user-avatar{width:40px;height:40px;border-radius:10px;background:linear-gradient(135deg,var(--teal-400),var(--teal-600));display:flex;align-items:center;justify-content:center;font-weight:700;font-size:14px;color:var(--navy-900)}.user-name{font-size:14px;font-weight:600}.user-plan{font-size:12px;color:var(--teal-400)}.main-content{flex:1;margin-left:280px;padding:32px;min-height:100vh}
.page-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:32px;flex-wrap:wrap;gap:16px}.page-title{font-size:28px;font-weight:700}.page-subtitle{font-size:15px;color:var(--gray-400);margin-top:4px}.header-actions{display:flex;gap:12px}
.stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:20px;margin-bottom:32px}.stat-card{background:var(--navy-800);border:1px solid var(--navy-600);border-radius:16px;padding:24px;transition:all 0.2s}.stat-card:hover{border-color:var(--teal-400);transform:translateY(-2px)}.stat-icon{width:48px;height:48px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:24px;margin-bottom:16px}.stat-icon.teal{background:var(--teal-glow)}.stat-icon.green{background:rgba(34,197,94,0.15)}.stat-icon.purple{background:rgba(168,85,247,0.15)}.stat-icon.orange{background:rgba(249,115,22,0.15)}.stat-value{font-size:32px;font-weight:700;font-family:'JetBrains Mono',monospace;margin-bottom:4px}.stat-label{font-size:14px;color:var(--gray-400)}
.playbook-banner{background:linear-gradient(135deg,var(--navy-700),var(--navy-800));border:2px solid var(--teal-400);border-radius:20px;padding:32px;margin-bottom:32px;position:relative;overflow:hidden}.playbook-banner::before{content:'';position:absolute;top:-50%;right:-10%;width:300px;height:300px;background:radial-gradient(circle,rgba(45,212,191,0.1),transparent);border-radius:50%}.playbook-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:24px;flex-wrap:wrap;gap:16px}.playbook-title{font-size:14px;color:var(--teal-400);font-weight:600;text-transform:uppercase;letter-spacing:0.05em;margin-bottom:8px}.playbook-value{font-size:48px;font-weight:700;color:var(--green-400);font-family:'JetBrains Mono',monospace}.playbook-label{font-size:14px;color:var(--gray-400)}.playbook-plays{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px}.play-card{background:var(--navy-800);border:1px solid var(--navy-600);border-radius:12px;padding:16px;cursor:pointer;transition:all 0.2s}.play-card:hover{border-color:var(--teal-400);transform:translateY(-2px)}.play-card.complete{opacity:0.6}.play-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px}.play-name{font-size:14px;font-weight:600}.play-status{font-size:10px;font-weight:700;padding:4px 8px;border-radius:6px;background:var(--navy-600);color:var(--gray-400)}.play-card.complete .play-status{background:var(--green-500);color:var(--white)}.play-savings{font-size:18px;font-weight:700;color:var(--green-400);font-family:'JetBrains Mono',monospace}
.card{background:var(--navy-800);border:1px solid var(--navy-600);border-radius:16px;overflow:hidden}.card-header{display:flex;justify-content:space-between;align-items:center;padding:20px 24px;border-bottom:1px solid var(--navy-600)}.card-title{font-size:18px;font-weight:600}.card-body{padding:24px}
.quick-actions{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:32px}.quick-action{background:var(--navy-800);border:1px solid var(--navy-600);border-radius:12px;padding:20px;cursor:pointer;text-align:center;transition:all 0.2s}.quick-action:hover{border-color:var(--teal-400);background:var(--teal-glow)}.quick-action-icon{font-size:28px;margin-bottom:12px}.quick-action-title{font-size:14px;font-weight:600}.quick-action-desc{font-size:12px;color:var(--gray-500);margin-top:4px}
.strategy-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-bottom:32px}.strategy-card{background:var(--navy-800);border:1px solid var(--navy-600);border-radius:16px;padding:24px;cursor:pointer;transition:all 0.2s;position:relative}.strategy-card:hover{border-color:var(--teal-400);transform:translateY(-4px);box-shadow:0 12px 40px rgba(0,0,0,0.3)}.strategy-icon{width:56px;height:56px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:28px;margin-bottom:16px;background:var(--teal-glow)}.strategy-name{font-size:18px;font-weight:600;margin-bottom:8px}.strategy-savings{font-size:14px;color:var(--green-400);font-weight:600;margin-bottom:8px}.strategy-desc{font-size:14px;color:var(--gray-400);line-height:1.5}.strategy-level{position:absolute;top:16px;right:16px;font-size:10px;font-weight:700;text-transform:uppercase;padding:4px 10px;border-radius:20px}.strategy-level.starter{background:rgba(45,212,191,0.2);color:var(--teal-400)}.strategy-level.growth{background:rgba(168,85,247,0.2);color:var(--purple-400)}.strategy-level.wealth{background:rgba(249,115,22,0.2);color:var(--orange-400)}.strategy-level.elite{background:rgba(239,68,68,0.2);color:var(--red-400)}
.level-tabs{display:flex;gap:8px;margin-bottom:24px;flex-wrap:wrap}.level-tab{padding:10px 20px;border-radius:10px;font-size:14px;font-weight:600;cursor:pointer;background:var(--navy-700);color:var(--gray-400);border:1px solid transparent;transition:all 0.2s}.level-tab:hover{color:var(--white)}.level-tab.active{background:var(--teal-glow);color:var(--teal-400);border-color:var(--teal-400)}
.upload-zone{border:2px dashed var(--navy-600);border-radius:16px;padding:48px;text-align:center;cursor:pointer;transition:all 0.2s}.upload-zone:hover{border-color:var(--teal-400);background:var(--teal-glow)}.upload-icon{font-size:48px;margin-bottom:16px}.upload-title{font-size:18px;font-weight:600;margin-bottom:8px}.upload-subtitle{color:var(--gray-400);font-size:14px}
.receipt-list{display:flex;flex-direction:column;gap:12px}.receipt-item{display:flex;align-items:center;gap:16px;padding:16px;background:var(--navy-700);border-radius:12px}.receipt-icon{width:48px;height:48px;border-radius:10px;background:var(--navy-600);display:flex;align-items:center;justify-content:center;font-size:24px}.receipt-info{flex:1}.receipt-name{font-weight:600;margin-bottom:4px}.receipt-meta{font-size:13px;color:var(--gray-500)}.receipt-amount{font-size:18px;font-weight:700;font-family:'JetBrains Mono',monospace;color:var(--teal-400)}
.calc-layout{display:grid;grid-template-columns:1fr 380px;gap:32px}.calc-form,.calc-results{background:var(--navy-800);border:1px solid var(--navy-600);border-radius:16px;padding:28px}.calc-results{height:fit-content;position:sticky;top:32px}.calc-title{font-size:18px;font-weight:600;margin-bottom:24px}.calc-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px}.calc-grid .full{grid-column:span 2}.result-item{padding:16px 0;border-bottom:1px solid var(--navy-600)}.result-item:last-child{border-bottom:none}.result-label{font-size:13px;color:var(--gray-500);margin-bottom:4px}.result-value{font-size:28px;font-weight:700;font-family:'JetBrains Mono',monospace}.result-value.teal{color:var(--teal-400)}.result-value.green{color:var(--green-400)}.result-sub{font-size:13px;color:var(--gray-500);margin-top:4px}.info-box{background:var(--navy-700);border-radius:12px;padding:16px;margin-top:20px}.info-box-title{font-size:14px;font-weight:600;color:var(--teal-400);margin-bottom:8px}.info-box p{font-size:13px;color:var(--gray-300);line-height:1.6}
.chat-container{display:flex;flex-direction:column;height:calc(100vh - 180px);background:var(--navy-800);border:1px solid var(--navy-600);border-radius:16px;overflow:hidden}.chat-messages{flex:1;overflow-y:auto;padding:24px;display:flex;flex-direction:column;gap:16px}.chat-message{display:flex;gap:12px;max-width:85%}.chat-message.user{align-self:flex-end;flex-direction:row-reverse}.chat-avatar{width:40px;height:40px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:16px;font-weight:700;flex-shrink:0}.chat-message.assistant .chat-avatar{background:linear-gradient(135deg,var(--teal-400),var(--teal-600));color:var(--navy-900)}.chat-message.user .chat-avatar{background:var(--navy-600)}.chat-bubble{padding:16px 20px;border-radius:16px;font-size:15px;line-height:1.7}.chat-message.assistant .chat-bubble{background:var(--navy-700);border-bottom-left-radius:4px}.chat-message.user .chat-bubble{background:var(--teal-600);border-bottom-right-radius:4px}.chat-bubble strong{color:var(--teal-400)}.chat-input-area{padding:20px 24px;border-top:1px solid var(--navy-600);display:flex;gap:12px}.chat-input{flex:1;background:var(--navy-700);border:1px solid var(--navy-600);border-radius:12px;padding:14px 18px;color:var(--white);font-size:15px;font-family:inherit;resize:none}.chat-input:focus{outline:none;border-color:var(--teal-400)}
.asset-row{display:grid;grid-template-columns:2fr 1fr 1fr 100px;gap:16px;padding:16px 24px;border-bottom:1px solid var(--navy-600);align-items:center;cursor:pointer;transition:background 0.2s}.asset-row:hover{background:var(--navy-700)}.asset-info{display:flex;align-items:center;gap:14px}.asset-icon{width:44px;height:44px;border-radius:10px;background:var(--navy-700);display:flex;align-items:center;justify-content:center;font-size:20px}.asset-name{font-weight:600}.asset-type{font-size:13px;color:var(--gray-500)}.asset-value{font-family:'JetBrains Mono',monospace}.dep-bar{width:100%;height:6px;background:var(--navy-600);border-radius:3px;overflow:hidden}.dep-fill{height:100%;background:linear-gradient(90deg,var(--teal-400),var(--teal-600));border-radius:3px}.status-badge{display:inline-flex;padding:6px 12px;border-radius:20px;font-size:12px;font-weight:600}.status-badge.active{background:rgba(34,197,94,0.15);color:var(--green-400)}
.checklist{display:flex;flex-direction:column;gap:12px}.checklist-item{display:flex;align-items:flex-start;gap:16px;padding:16px;background:var(--navy-700);border-radius:12px;cursor:pointer;transition:all 0.2s}.checklist-item:hover{background:var(--navy-600)}.checklist-item.complete{opacity:0.6}.checklist-check{width:24px;height:24px;border:2px solid var(--navy-500);border-radius:6px;display:flex;align-items:center;justify-content:center;flex-shrink:0}.checklist-item.complete .checklist-check{background:var(--green-500);border-color:var(--green-500)}.checklist-content{flex:1}.checklist-title{font-weight:600;margin-bottom:4px}.checklist-desc{font-size:13px;color:var(--gray-400)}
.integration-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}.integration-card{background:var(--navy-700);border:1px solid var(--navy-600);border-radius:12px;padding:24px;text-align:center;cursor:pointer;transition:all 0.2s}.integration-card:hover{border-color:var(--teal-400)}.integration-card.connected{border-color:var(--green-500)}.integration-icon{font-size:36px;margin-bottom:12px}.integration-name{font-weight:600;margin-bottom:4px}.integration-status{font-size:12px;color:var(--gray-500)}.integration-card.connected .integration-status{color:var(--green-400)}
.modal-overlay{position:fixed;inset:0;background:rgba(10,22,40,0.9);display:none;align-items:center;justify-content:center;z-index:1000;padding:24px}.modal-overlay.active{display:flex}.modal{background:var(--navy-800);border:1px solid var(--navy-600);border-radius:20px;width:100%;max-width:700px;max-height:90vh;overflow:hidden;display:flex;flex-direction:column}.modal-header{padding:24px;border-bottom:1px solid var(--navy-600);display:flex;justify-content:space-between;align-items:center}.modal-title{font-size:22px;font-weight:700}.modal-close{background:none;border:none;color:var(--gray-400);cursor:pointer;font-size:28px;width:44px;height:44px;display:flex;align-items:center;justify-content:center;border-radius:10px}.modal-close:hover{background:var(--navy-700);color:var(--white)}.modal-body{padding:24px;overflow-y:auto;flex:1}.modal-footer{padding:20px 24px;border-top:1px solid var(--navy-600);display:flex;justify-content:flex-end;gap:12px}
.detail-section{margin-bottom:24px}.detail-section-title{font-size:16px;font-weight:600;color:var(--teal-400);margin-bottom:12px}.detail-section p{font-size:15px;line-height:1.7;color:var(--gray-300)}.detail-section ul{list-style:none;padding:0}.detail-section li{font-size:14px;color:var(--gray-300);padding:10px 0 10px 24px;position:relative;border-bottom:1px solid var(--navy-600)}.detail-section li::before{content:'‚Üí';position:absolute;left:0;color:var(--teal-400)}.example-box{background:var(--navy-700);border-radius:12px;padding:20px;margin:16px 0}.example-title{font-size:14px;font-weight:600;color:var(--teal-400);margin-bottom:12px}.example-row{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--navy-600);font-size:14px}.example-row:last-child{border-bottom:none;font-weight:600;color:var(--green-400)}
.toast-container{position:fixed;bottom:24px;right:24px;z-index:2000}.toast{background:var(--navy-700);border:1px solid var(--green-500);border-radius:12px;padding:16px 20px;display:flex;align-items:center;gap:12px;animation:slideIn 0.3s}@keyframes slideIn{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}
.empty-state{text-align:center;padding:60px 24px}.empty-state-icon{font-size:48px;margin-bottom:16px}.empty-state h3{font-size:20px;margin-bottom:12px}.empty-state p{color:var(--gray-500);margin-bottom:24px}
@media(max-width:1200px){.stats-grid,.quick-actions{grid-template-columns:repeat(2,1fr)}.strategy-grid,.integration-grid{grid-template-columns:repeat(2,1fr)}.calc-layout{grid-template-columns:1fr}}
@media(max-width:768px){.sidebar{transform:translateX(-100%);transition:transform 0.3s}.sidebar.open{transform:translateX(0)}.main-content{margin-left:0}.stats-grid,.quick-actions,.strategy-grid,.integration-grid{grid-template-columns:1fr}.form-row,.calc-grid{grid-template-columns:1fr}.playbook-plays{grid-template-columns:1fr}.mobile-menu{display:flex!important}}
.mobile-menu{display:none;position:fixed;bottom:24px;left:24px;z-index:101;width:56px;height:56px;border-radius:50%;background:var(--teal-500);border:none;color:var(--navy-900);font-size:24px;cursor:pointer;box-shadow:0 4px 20px rgba(45,212,191,0.4);align-items:center;justify-content:center}
    </style>
</head>
<body>
<div class="toast-container" id="toastContainer"></div>
<button class="mobile-menu" onclick="toggleSidebar()">‚ò∞</button>

<!-- LOGIN -->
<div class="view active" id="loginView">
    <div class="auth-container">
        <div class="auth-card">
            <div class="logo"><svg viewBox="0 0 40 40" fill="none"><rect x="4" y="24" width="8" height="12" rx="2" fill="url(#g1)"/><rect x="16" y="16" width="8" height="20" rx="2" fill="url(#g1)"/><rect x="28" y="8" width="8" height="28" rx="2" fill="url(#g1)"/><defs><linearGradient id="g1" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#2DD4BF"/><stop offset="100%" stop-color="#0D9488"/></linearGradient></defs></svg><div class="logo-text">Depreciation<span>IQ</span></div></div>
            <h1 class="auth-title">Welcome back</h1>
            <p class="auth-subtitle">Keep more of what you earn</p>
            <form id="loginForm">
                <div class="form-group"><label class="form-label">Email</label><input type="email" class="form-input" id="loginEmail" placeholder="you@company.com" required></div>
                <div class="form-group"><label class="form-label">Password</label><input type="password" class="form-input" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required></div>
                <button type="submit" class="btn btn-primary btn-full btn-lg">Sign In</button>
            </form>
            <p class="auth-footer">Don't have an account? <a onclick="showView('signupView')">Start free trial</a></p>
        </div>
    </div>
</div>

<!-- SIGNUP -->
<div class="view" id="signupView">
    <div class="auth-container">
        <div class="auth-card">
            <div class="logo"><svg viewBox="0 0 40 40" fill="none"><rect x="4" y="24" width="8" height="12" rx="2" fill="url(#g1)"/><rect x="16" y="16" width="8" height="20" rx="2" fill="url(#g1)"/><rect x="28" y="8" width="8" height="28" rx="2" fill="url(#g1)"/></svg><div class="logo-text">Depreciation<span>IQ</span></div></div>
            <h1 class="auth-title">Start free trial</h1>
            <p class="auth-subtitle">14 days free, no credit card</p>
            <form id="signupForm">
                <div class="form-row"><div class="form-group"><label class="form-label">First name</label><input type="text" class="form-input" id="signupFirst" required></div><div class="form-group"><label class="form-label">Last name</label><input type="text" class="form-input" id="signupLast" required></div></div>
                <div class="form-group"><label class="form-label">Email</label><input type="email" class="form-input" id="signupEmail" required></div>
                <div class="form-group"><label class="form-label">Password</label><input type="password" class="form-input" id="signupPassword" required></div>
                <button type="submit" class="btn btn-primary btn-full btn-lg">Create Account</button>
            </form>
            <p class="auth-footer">Have an account? <a onclick="showView('loginView')">Sign in</a></p>
        </div>
    </div>
</div>

<!-- ONBOARDING -->
<div class="view" id="onboardingView">
    <div class="onboarding-container">
        <div class="onboarding-card">
            <div class="onboarding-progress"><div class="progress-step" id="step1"></div><div class="progress-step" id="step2"></div><div class="progress-step" id="step3"></div><div class="progress-step" id="step4"></div></div>
            <div id="onboardingContent"></div>
        </div>
    </div>
</div>

<!-- APP -->
<div class="view" id="appView">
    <div class="app-layout">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-logo"><svg viewBox="0 0 40 40" fill="none" width="36" height="36"><rect x="4" y="24" width="8" height="12" rx="2" fill="url(#g1)"/><rect x="16" y="16" width="8" height="20" rx="2" fill="url(#g1)"/><rect x="28" y="8" width="8" height="28" rx="2" fill="url(#g1)"/></svg><div class="logo-text">Depreciation<span>IQ</span></div></div>
            <nav>
                <div class="nav-section"><div class="nav-label">Overview</div>
                    <div class="nav-item active" data-page="dashboard"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="9" rx="1"/><rect x="14" y="3" width="7" height="5" rx="1"/><rect x="14" y="12" width="7" height="9" rx="1"/><rect x="3" y="16" width="7" height="5" rx="1"/></svg>Dashboard</div>
                    <div class="nav-item" data-page="playbook"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5M2 12l10 5 10-5"/></svg>My Playbook<span class="nav-badge hot" id="playCount">0</span></div>
                    <div class="nav-item" data-page="strategies"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>Strategies<span class="nav-badge">16</span></div>
                </div>
                <div class="nav-section"><div class="nav-label">Track</div>
                    <div class="nav-item" data-page="assets"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>Assets<span class="nav-badge" id="assetCount">0</span></div>
                    <div class="nav-item" data-page="receipts"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14,2 14,8 20,8"/></svg>Receipts<span class="nav-badge new" id="receiptCount">0</span></div>
                </div>
                <div class="nav-section"><div class="nav-label">Calculators</div>
                    <div class="nav-item" data-page="calc-scorp"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><path d="M20 8v6M23 11h-6"/></svg>S-Corp</div>
                    <div class="nav-item" data-page="calc-vehicle"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 17h14v-5l-2-5H7L5 12v5z"/><circle cx="7.5" cy="17.5" r="1.5"/><circle cx="16.5" cy="17.5" r="1.5"/></svg>Vehicle</div>
                    <div class="nav-item" data-page="calc-401k"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18M9 21V9"/></svg>Solo 401(k)</div>
                    <div class="nav-item" data-page="calc-hirekids"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>Hire Kids</div>
                </div>
                <div class="nav-section"><div class="nav-label">Tools</div>
                    <div class="nav-item" data-page="ai-advisor"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>AI Advisor</div>
                    <div class="nav-item" data-page="integrations"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M12 1v6M12 17v6M4.22 4.22l4.24 4.24M15.54 15.54l4.24 4.24M1 12h6M17 12h6M4.22 19.78l4.24-4.24M15.54 8.46l4.24-4.24"/></svg>Integrations</div>
                    <div class="nav-item" data-page="settings"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>Settings</div>
                </div>
                <div class="nav-section"><div class="nav-item" onclick="logout()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16,17 21,12 16,7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>Sign Out</div></div>
            </nav>
            <div class="sidebar-footer"><div class="user-card"><div class="user-avatar" id="userAvatar">U</div><div><div class="user-name" id="userName">User</div><div class="user-plan">Pro Plan</div></div></div></div>
        </aside>
        <main class="main-content" id="mainContent"></main>
    </div>
</div>

<!-- MODALS -->
<div class="modal-overlay" id="assetModal">
    <div class="modal" style="max-width:600px">
        <div class="modal-header"><h2 class="modal-title" id="assetModalTitle">Add Asset</h2><button class="modal-close" onclick="closeModal('assetModal')">√ó</button></div>
        <div class="modal-body">
            <form id="assetForm">
                <div class="form-row"><div class="form-group"><label class="form-label">Type</label><select class="form-select" id="assetType" required><option value="">Select...</option><option value="vehicle">üöó Vehicle</option><option value="equipment">üíª Equipment</option><option value="furniture">ü™ë Furniture</option><option value="realestate">üè† Real Estate</option><option value="other">üì¶ Other</option></select></div><div class="form-group"><label class="form-label">Status</label><select class="form-select" id="assetStatus"><option value="active">Active</option><option value="sold">Sold</option></select></div></div>
                <div class="form-group"><label class="form-label">Name</label><input type="text" class="form-input" id="assetName" placeholder="2024 Ford F-150" required></div>
                <div class="form-row"><div class="form-group"><label class="form-label">Purchase Date</label><input type="date" class="form-input" id="assetDate" required></div><div class="form-group"><label class="form-label">Price ($)</label><input type="number" class="form-input" id="assetPrice" placeholder="55000" required></div></div>
                <div class="form-row"><div class="form-group"><label class="form-label">Business Use %</label><input type="number" class="form-input" id="assetBusiness" value="100" min="0" max="100"></div><div class="form-group"><label class="form-label">Recovery Period</label><select class="form-select" id="assetPeriod"><option value="5">5 Years</option><option value="7" selected>7 Years</option><option value="15">15 Years</option><option value="27.5">27.5 Years</option><option value="39">39 Years</option></select></div></div>
            </form>
        </div>
        <div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal('assetModal')">Cancel</button><button class="btn btn-primary" id="deleteAssetBtn" onclick="deleteAsset()" style="background:#EF4444;display:none">Delete</button><button class="btn btn-primary" onclick="saveAsset()">Save</button></div>
    </div>
</div>

<div class="modal-overlay" id="receiptModal">
    <div class="modal" style="max-width:500px">
        <div class="modal-header"><h2 class="modal-title">Add Receipt</h2><button class="modal-close" onclick="closeModal('receiptModal')">√ó</button></div>
        <div class="modal-body">
            <form id="receiptForm">
                <div class="form-group"><label class="form-label">Vendor</label><input type="text" class="form-input" id="receiptVendor" placeholder="Amazon, Home Depot..." required></div>
                <div class="form-row"><div class="form-group"><label class="form-label">Date</label><input type="date" class="form-input" id="receiptDate" required></div><div class="form-group"><label class="form-label">Amount ($)</label><input type="number" class="form-input" id="receiptAmount" step="0.01" required></div></div>
                <div class="form-group"><label class="form-label">Category</label><select class="form-select" id="receiptCategory"><option value="supplies">Office Supplies</option><option value="equipment">Equipment</option><option value="travel">Travel</option><option value="meals">Meals</option><option value="software">Software</option><option value="utilities">Utilities</option><option value="other">Other</option></select></div>
                <div class="form-group"><label class="form-label">Notes</label><input type="text" class="form-input" id="receiptNotes" placeholder="Optional..."></div>
            </form>
        </div>
        <div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal('receiptModal')">Cancel</button><button class="btn btn-primary" onclick="saveReceipt()">Save</button></div>
    </div>
</div>

<div class="modal-overlay" id="strategyModal">
    <div class="modal"><div class="modal-header"><h2 class="modal-title" id="strategyModalTitle">Strategy</h2><button class="modal-close" onclick="closeModal('strategyModal')">√ó</button></div><div class="modal-body" id="strategyModalBody"></div></div>
</div>

<script>
// STATE
const STATE = {user:null,profile:{income:0,entity:'sole',filingStatus:'single',age:35,kids:[],hasHomeOffice:false,has401k:false,vehicles:[]},assets:[],receipts:[],completedPlays:[],chatHistory:[],page:'dashboard',onboardingStep:1,strategyLevel:'all'};

// STRATEGIES DATABASE
const STRATEGIES = [
    {id:'s_corp',name:'S-Corporation Election',icon:'üè¢',level:'starter',minIncome:50000,savings:(p)=>(p.income*0.5)*0.153,summary:'Split income between salary and distributions. Avoid 15.3% SE tax.',condition:(p)=>p.income>50000&&p.entity!=='scorp',steps:['Confirm profit exceeds $50K','Determine reasonable salary (40-60%)','File Form 2553','Set up payroll','Take rest as distributions'],questions:['Income high enough?','Reasonable salary?','Late election?']},
    {id:'solo_401k',name:'Solo 401(k)',icon:'üè¶',level:'starter',minIncome:30000,savings:(p)=>Math.min(69000,p.income*0.25+23000)*getTaxBracket(p.income),summary:'Contribute up to $69,000/year tax-deferred.',condition:(p)=>p.income>30000&&!p.has401k,steps:['Open by December 31','Choose provider (Fidelity, Schwab)','Calculate max contribution','Contribute by tax deadline'],questions:['Max contribution?','Traditional or Roth?']},
    {id:'heavy_vehicle',name:'Heavy Vehicle Strategy',icon:'üöõ',level:'starter',minIncome:50000,savings:(p)=>57200*getTaxBracket(p.income),summary:'Vehicles over 6,000 lbs GVWR get $50K+ Year 1 deduction.',condition:(p)=>p.vehicles?.some(v=>v.gvwr>=6000)||false,steps:['Verify GVWR over 6,000 lbs','Confirm 50%+ business use','Calculate Section 179','Add 60% bonus depreciation','Keep mileage log'],vehicles:['F-150','Silverado','Tahoe','Expedition','Escalade','G-Wagon'],questions:['Vehicle qualify?','Documentation?']},
    {id:'hire_kids',name:'Hire Your Kids',icon:'üë®‚Äçüëß',level:'starter',minIncome:40000,savings:(p)=>(p.kids?.filter(k=>k.age>=7&&k.age<18).length||0)*14600*(getTaxBracket(p.income)+0.153),summary:'Pay children up to $14,600 tax-free.',condition:(p)=>p.kids?.some(k=>k.age>=7&&k.age<18),steps:['Identify legitimate work','Set reasonable rate','Keep time sheets','Pay via check','Fund their Roth IRA'],jobs:['Cleaning','Filing','Social media','Data entry'],questions:['Reasonable pay?','Need payroll?']},
    {id:'home_office',name:'Home Office Deduction',icon:'üè†',level:'starter',minIncome:20000,savings:(p)=>2400*getTaxBracket(p.income),summary:'Deduct portion of rent/utilities for workspace.',condition:(p)=>p.hasHomeOffice,steps:['Designate exclusive space','Measure footage','Calculate percentage','Choose simplified or actual','Take photos'],questions:['Simplified or actual?','Recapture?']},
    {id:'augusta_rule',name:'Augusta Rule',icon:'üè°',level:'growth',minIncome:100000,savings:(p)=>18000*getTaxBracket(p.income),summary:'Rent home to business 14 days/year tax-free.',condition:(p)=>p.income>100000&&p.entity!=='w2',steps:['Document meetings at home','Research rental rates','Create agreement','Invoice business','Keep minutes'],questions:['Reasonable rent?','Documentation?']},
    {id:'daf',name:'Donor Advised Fund',icon:'üíù',level:'growth',minIncome:150000,savings:(p)=>20000*getTaxBracket(p.income),summary:'Bunch donations. Donate stock to avoid gains.',condition:(p)=>p.income>150000,steps:['Open DAF account','Identify appreciated assets','Transfer stock directly','Get immediate deduction','Distribute over time'],questions:['Stock or cash?','AGI limits?']},
    {id:'defined_benefit',name:'Defined Benefit Plan',icon:'üìä',level:'growth',minIncome:300000,savings:(p)=>150000*getTaxBracket(p.income),summary:'Contribute $200K-$300K/year for high earners 45+.',condition:(p)=>p.income>300000&&p.age>=45,steps:['Verify consistent income ($300K+)','Engage TPA','Actuary designs plan','Make required contributions'],questions:['Income consistent?','Combine with 401k?']},
    {id:'cost_seg',name:'Cost Segregation',icon:'üèóÔ∏è',level:'growth',minIncome:200000,savings:(p)=>100000*getTaxBracket(p.income),summary:'Reclassify building components to accelerate depreciation.',condition:(p)=>p.assets?.some(a=>a.type==='realestate'&&a.price>500000),steps:['Verify property $500K+','Hire cost seg firm','Receive study','Reclassify components','Apply bonus depreciation'],questions:['Property valuable enough?','Lookback?']},
    {id:'rep_status',name:'Real Estate Professional',icon:'üîë',level:'wealth',minIncome:300000,savings:(p)=>150000*getTaxBracket(p.income),summary:'Unlock RE losses against W-2 income.',condition:(p)=>p.income>300000,steps:['One spouse must qualify','Track 750+ hours','More than 50% time in RE','Make aggregation election','Keep time log'],questions:['Can I qualify?','What counts?']},
    {id:'1031_exchange',name:'1031 Exchange',icon:'üîÑ',level:'wealth',minIncome:500000,savings:(p)=>200000*0.238,summary:'Sell property, buy replacement, defer ALL gains.',condition:(p)=>p.assets?.some(a=>a.type==='realestate'),steps:['Engage QI before sale','Never touch proceeds','Identify within 45 days','Close within 180 days','Replace equal or greater'],questions:['Property qualify?','Partial 1031?']},
    {id:'opportunity_zones',name:'Opportunity Zones',icon:'üìç',level:'wealth',minIncome:500000,savings:(p)=>500000*0.20,summary:'Invest gains into OZ. Hold 10+ years = $0 on new gains.',condition:(p)=>p.income>500000,steps:['Identify gain to defer','Invest within 180 days','Choose QOF','Hold 10+ years'],questions:['Gain qualify?','Legitimate investments?']},
    {id:'qsbs',name:'Qualified Small Business Stock',icon:'üìà',level:'wealth',minIncome:500000,savings:(p)=>2380000,summary:'C-Corp stock held 5+ years: exclude $10M from gains.',condition:(p)=>p.income>500000,steps:['Start as C-Corp','Under $50M assets','Hold 5+ years','Gift to family'],questions:['Company qualify?','Gift shares?']},
    {id:'buy_borrow_die',name:'Buy, Borrow, Die',icon:'üíé',level:'elite',minIncome:2000000,savings:(p)=>p.income*0.15,summary:'How billionaires pay $0. Buy assets, borrow, die with step-up.',condition:(p)=>p.income>2000000,steps:['Accumulate assets','Never sell','Borrow against assets','Die with step-up'],questions:['Interest deductible?','Estate tax?']},
    {id:'captive_insurance',name:'Captive Insurance',icon:'üõ°Ô∏è',level:'elite',minIncome:1000000,savings:(p)=>400000*getTaxBracket(p.income),summary:'Create own insurance company. Premiums deductible.',condition:(p)=>p.income>1000000,warning:'IRS scrutiny area.',steps:['Verify $1M+ revenue','Identify risks','Engage manager','Get actuarial study'],questions:['Large enough?','Avoid problems?']},
    {id:'ppli',name:'Private Placement Life Insurance',icon:'üé©',level:'elite',minIncome:5000000,savings:(p)=>p.income*0.10,summary:'Ultra-wealthy wrapper. All growth tax-free.',condition:(p)=>p.income>5000000,warning:'$5M+ minimum.',steps:['Confirm $5M+ assets','Engage specialist','Medical underwriting'],questions:['Enough assets?','Access funds?']}
];

// UTILITIES
function getTaxBracket(income){if(income>578125)return 0.37;if(income>231250)return 0.35;if(income>182100)return 0.32;if(income>95375)return 0.24;if(income>44725)return 0.22;if(income>11000)return 0.12;return 0.10}
function formatCurrency(n){return '$'+(n||0).toLocaleString('en-US',{minimumFractionDigits:0,maximumFractionDigits:0})}
function loadState(){const s=localStorage.getItem('diq_v2');if(s)Object.assign(STATE,JSON.parse(s))}
function saveState(){localStorage.setItem('diq_v2',JSON.stringify(STATE))}
function toast(msg,type='success'){const t=document.createElement('div');t.className='toast';t.style.borderColor=type==='error'?'var(--red-500)':'var(--green-500)';t.innerHTML='<span style="color:'+(type==='error'?'var(--red-400)':'var(--green-400)')+'">'+(type==='error'?'‚úï':'‚úì')+'</span><span>'+msg+'</span>';document.getElementById('toastContainer').appendChild(t);setTimeout(()=>t.remove(),3000)}
function showView(id){document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));document.getElementById(id).classList.add('active')}
function closeModal(id){document.getElementById(id).classList.remove('active')}
function toggleSidebar(){document.getElementById('sidebar').classList.toggle('open')}

// PLAYBOOK ENGINE
function generatePlaybook(){const plays=[];STRATEGIES.forEach(s=>{if(s.condition(STATE.profile)){const savings=s.savings(STATE.profile);if(savings>0)plays.push({...s,calculatedSavings:savings,complete:STATE.completedPlays.includes(s.id)})}});return plays.sort((a,b)=>b.calculatedSavings-a.calculatedSavings)}
function getTotalSavings(){return generatePlaybook().reduce((sum,p)=>sum+(p.complete?0:p.calculatedSavings),0)}

// INIT
function init(){
    loadState();
    document.querySelectorAll('.nav-item[data-page]').forEach(item=>{item.addEventListener('click',()=>{document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));item.classList.add('active');STATE.page=item.dataset.page;saveState();renderPage(STATE.page);document.getElementById('sidebar').classList.remove('open')})});
    document.getElementById('loginForm').addEventListener('submit',e=>{e.preventDefault();STATE.user={email:document.getElementById('loginEmail').value,name:document.getElementById('loginEmail').value.split('@')[0]};saveState();if(!STATE.profile.income){showView('onboardingView');renderOnboarding()}else{showView('appView');updateUI();renderPage('dashboard')}toast('Welcome back!')});
    document.getElementById('signupForm').addEventListener('submit',e=>{e.preventDefault();STATE.user={email:document.getElementById('signupEmail').value,name:document.getElementById('signupFirst').value+' '+document.getElementById('signupLast').value};saveState();showView('onboardingView');renderOnboarding();toast('Account created!')});
    if(STATE.user){if(!STATE.profile.income){showView('onboardingView');renderOnboarding()}else{showView('appView');updateUI();renderPage(STATE.page)}}else{showView('loginView')}
}

function updateUI(){if(STATE.user){document.getElementById('userName').textContent=STATE.user.name;document.getElementById('userAvatar').textContent=STATE.user.name.charAt(0).toUpperCase()}document.getElementById('assetCount').textContent=STATE.assets.length;document.getElementById('receiptCount').textContent=STATE.receipts.length;document.getElementById('playCount').textContent=generatePlaybook().filter(p=>!p.complete).length}
function logout(){STATE.user=null;saveState();showView('loginView');toast('Signed out')}
function navigateTo(page){STATE.page=page;saveState();document.querySelectorAll('.nav-item').forEach(n=>n.classList.toggle('active',n.dataset.page===page));renderPage(page)}

// ONBOARDING
function renderOnboarding(){
    const step=STATE.onboardingStep;
    for(let i=1;i<=4;i++){const el=document.getElementById('step'+i);el.className='progress-step';if(i<step)el.classList.add('complete');if(i===step)el.classList.add('active')}
    const c=document.getElementById('onboardingContent');
    if(step===1){
        c.innerHTML='<h2 class="onboarding-title">Let\'s personalize your playbook</h2><p class="onboarding-subtitle">Tell us about your income to unlock the right strategies</p><div class="form-group"><label class="form-label">Estimated Annual Income ($)</label><input type="number" class="form-input" id="obIncome" value="'+(STATE.profile.income||'')+'" placeholder="150000"></div><div class="form-group"><label class="form-label">Business Entity Type</label><select class="form-select" id="obEntity"><option value="sole" '+(STATE.profile.entity==='sole'?'selected':'')+'>Sole Proprietor</option><option value="llc" '+(STATE.profile.entity==='llc'?'selected':'')+'>Single-Member LLC</option><option value="scorp" '+(STATE.profile.entity==='scorp'?'selected':'')+'>S-Corporation</option><option value="w2" '+(STATE.profile.entity==='w2'?'selected':'')+'>W-2 Employee + Side Business</option></select></div><div class="form-row"><div class="form-group"><label class="form-label">Filing Status</label><select class="form-select" id="obFiling"><option value="single" '+(STATE.profile.filingStatus==='single'?'selected':'')+'>Single</option><option value="mfj" '+(STATE.profile.filingStatus==='mfj'?'selected':'')+'>Married Filing Jointly</option></select></div><div class="form-group"><label class="form-label">Your Age</label><input type="number" class="form-input" id="obAge" value="'+(STATE.profile.age||35)+'" min="18" max="99"></div></div><div class="onboarding-nav"><div></div><button class="btn btn-primary btn-lg" onclick="nextOnboarding()">Continue ‚Üí</button></div>';
    }else if(step===2){
        c.innerHTML='<h2 class="onboarding-title">Your situation</h2><p class="onboarding-subtitle">Help us find more opportunities</p><div class="form-group"><label class="form-label">Children under 18? (Enter ages separated by commas)</label><input type="text" class="form-input" id="obKidAges" value="'+(STATE.profile.kids?.map(k=>k.age).join(', ')||'')+'" placeholder="8, 12, 16"></div><div class="form-group"><label class="form-label">Do you have a dedicated home office?</label><select class="form-select" id="obHomeOffice"><option value="no" '+(STATE.profile.hasHomeOffice?'':'selected')+'>No</option><option value="yes" '+(STATE.profile.hasHomeOffice?'selected':'')+'>Yes</option></select></div><div class="form-group"><label class="form-label">Do you have a retirement plan (401k, SEP)?</label><select class="form-select" id="ob401k"><option value="no" '+(STATE.profile.has401k?'':'selected')+'>No</option><option value="yes" '+(STATE.profile.has401k?'selected':'')+'>Yes</option></select></div><div class="onboarding-nav"><button class="btn btn-ghost" onclick="prevOnboarding()">‚Üê Back</button><button class="btn btn-primary btn-lg" onclick="nextOnboarding()">Continue ‚Üí</button></div>';
    }else if(step===3){
        c.innerHTML='<h2 class="onboarding-title">Your vehicles</h2><p class="onboarding-subtitle">Heavy vehicles (6,000+ lbs) qualify for big deductions</p><div class="form-group"><label class="form-label">Do you have a business vehicle?</label><select class="form-select" id="obVehicleType"><option value="">No business vehicle</option><option value="car">Regular car (under 6,000 lbs)</option><option value="heavy">Heavy SUV/Truck (6,000+ lbs)</option></select></div><div class="info-box"><div class="info-box-title">üöõ Heavy Vehicles (6,000+ lbs GVWR)</div><p>Ford F-150, Chevy Silverado, Tahoe, Suburban, GMC Yukon, Cadillac Escalade, Mercedes G-Wagon, Range Rover, Toyota Land Cruiser</p></div><div class="onboarding-nav"><button class="btn btn-ghost" onclick="prevOnboarding()">‚Üê Back</button><button class="btn btn-primary btn-lg" onclick="nextOnboarding()">Continue ‚Üí</button></div>';
    }else if(step===4){
        const plays=generatePlaybook();const total=plays.reduce((s,p)=>s+p.calculatedSavings,0);
        c.innerHTML='<h2 class="onboarding-title">üéâ Your playbook is ready!</h2><p class="onboarding-subtitle">We found '+plays.length+' strategies that could save you</p><div style="text-align:center;margin:32px 0"><div style="font-size:56px;font-weight:700;color:var(--green-400);font-family:JetBrains Mono,monospace">'+formatCurrency(total)+'</div><div style="color:var(--gray-400)">per year in potential tax savings</div></div><div style="display:flex;flex-direction:column;gap:12px;margin-bottom:24px">'+plays.slice(0,5).map(p=>'<div style="display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background:var(--navy-700);border-radius:10px"><span>'+p.icon+' '+p.name+'</span><span style="color:var(--green-400);font-family:JetBrains Mono">'+formatCurrency(p.calculatedSavings)+'</span></div>').join('')+'</div><div class="onboarding-nav"><button class="btn btn-ghost" onclick="prevOnboarding()">‚Üê Back</button><button class="btn btn-primary btn-lg" onclick="finishOnboarding()">Go to Dashboard ‚Üí</button></div>';
    }
}

function nextOnboarding(){
    const step=STATE.onboardingStep;
    if(step===1){STATE.profile.income=parseInt(document.getElementById('obIncome').value)||0;STATE.profile.entity=document.getElementById('obEntity').value;STATE.profile.filingStatus=document.getElementById('obFiling').value;STATE.profile.age=parseInt(document.getElementById('obAge').value)||35}
    else if(step===2){const ages=document.getElementById('obKidAges').value.split(',').map(a=>parseInt(a.trim())).filter(a=>a>0);STATE.profile.kids=ages.map(age=>({age}));STATE.profile.hasHomeOffice=document.getElementById('obHomeOffice').value==='yes';STATE.profile.has401k=document.getElementById('ob401k').value==='yes'}
    else if(step===3){const vType=document.getElementById('obVehicleType').value;if(vType){STATE.profile.vehicles=[{type:vType,gvwr:vType==='heavy'?7000:4000}]}}
    STATE.onboardingStep++;saveState();renderOnboarding();
}
function prevOnboarding(){STATE.onboardingStep--;saveState();renderOnboarding()}
function finishOnboarding(){saveState();showView('appView');updateUI();renderPage('dashboard');toast('Welcome to your playbook!')}

// PAGE ROUTER
function renderPage(page){const c=document.getElementById('mainContent');updateUI();switch(page){case'dashboard':renderDashboard(c);break;case'playbook':renderPlaybook(c);break;case'strategies':renderStrategies(c);break;case'assets':renderAssets(c);break;case'receipts':renderReceipts(c);break;case'calc-scorp':renderSCorpCalc(c);break;case'calc-vehicle':renderVehicleCalc(c);break;case'calc-401k':render401kCalc(c);break;case'calc-hirekids':renderHireKidsCalc(c);break;case'ai-advisor':renderAIAdvisor(c);break;case'integrations':renderIntegrations(c);break;case'settings':renderSettings(c);break;default:renderDashboard(c)}}

// DASHBOARD
function renderDashboard(c){
    const plays=generatePlaybook();const totalSavings=plays.reduce((s,p)=>s+(p.complete?0:p.calculatedSavings),0);const stats=getStats();
    c.innerHTML='<div class="page-header"><div><h1 class="page-title">Dashboard</h1><p class="page-subtitle">Welcome back, '+(STATE.user?.name?.split(' ')[0]||'there')+'!</p></div><div class="header-actions"><button class="btn btn-secondary" onclick="openReceiptModal()">üìÑ Add Receipt</button><button class="btn btn-primary" onclick="openAssetModal()">+ Add Asset</button></div></div><div class="playbook-banner"><div class="playbook-header"><div><div class="playbook-title">üí∞ YOUR TAX SAVINGS OPPORTUNITY</div><div class="playbook-value">'+formatCurrency(totalSavings)+'</div><div class="playbook-label">potential annual savings from '+plays.filter(p=>!p.complete).length+' strategies</div></div><button class="btn btn-primary" onclick="navigateTo(\'playbook\')">View Playbook ‚Üí</button></div><div class="playbook-plays">'+plays.slice(0,4).map(p=>'<div class="play-card '+(p.complete?'complete':'')+'" onclick="showStrategy(\''+p.id+'\')"><div class="play-header"><span class="play-name">'+p.icon+' '+p.name+'</span><span class="play-status">'+(p.complete?'‚úì Done':'Action')+'</span></div><div class="play-savings">'+formatCurrency(p.calculatedSavings)+'</div></div>').join('')+'</div></div><div class="stats-grid"><div class="stat-card"><div class="stat-icon teal">üì¶</div><div class="stat-value">'+stats.assetCount+'</div><div class="stat-label">Assets</div></div><div class="stat-card"><div class="stat-icon green">üí∞</div><div class="stat-value">'+formatCurrency(stats.assetValue)+'</div><div class="stat-label">Value</div></div><div class="stat-card"><div class="stat-icon purple">üìâ</div><div class="stat-value">'+formatCurrency(stats.depreciation)+'</div><div class="stat-label">Depreciation</div></div><div class="stat-card"><div class="stat-icon orange">üßæ</div><div class="stat-value">'+STATE.receipts.length+'</div><div class="stat-label">Receipts</div></div></div><div class="quick-actions"><div class="quick-action" onclick="navigateTo(\'calc-scorp\')"><div class="quick-action-icon">üè¢</div><div class="quick-action-title">S-Corp Calculator</div></div><div class="quick-action" onclick="navigateTo(\'calc-vehicle\')"><div class="quick-action-icon">üöõ</div><div class="quick-action-title">Vehicle Calculator</div></div><div class="quick-action" onclick="navigateTo(\'ai-advisor\')"><div class="quick-action-icon">ü§ñ</div><div class="quick-action-title">AI Advisor</div></div><div class="quick-action" onclick="navigateTo(\'receipts\')"><div class="quick-action-icon">üìÑ</div><div class="quick-action-title">Upload Receipt</div></div></div>';
}

function getStats(){const active=STATE.assets.filter(a=>a.status==='active');const value=active.reduce((s,a)=>s+(a.price*a.business/100),0);let dep=0;active.forEach(a=>{dep+=(a.price*a.business/100)/(a.period||7)});return{assetCount:active.length,assetValue:value,depreciation:dep}}

// PLAYBOOK
function renderPlaybook(c){
    const plays=generatePlaybook();const total=plays.reduce((s,p)=>s+(p.complete?0:p.calculatedSavings),0);
    c.innerHTML='<div class="page-header"><div><h1 class="page-title">My Playbook</h1><p class="page-subtitle">Your personalized tax strategy action plan</p></div><div class="header-actions"><button class="btn btn-secondary" onclick="exportPlaybook()">üì• Export PDF</button></div></div><div class="playbook-banner" style="margin-bottom:32px"><div><div class="playbook-title">TOTAL POTENTIAL SAVINGS</div><div class="playbook-value">'+formatCurrency(total)+'</div><div class="playbook-label">'+plays.filter(p=>!p.complete).length+' strategies remaining</div></div></div><div class="checklist">'+plays.map(p=>'<div class="checklist-item '+(p.complete?'complete':'')+'" onclick="togglePlay(\''+p.id+'\')"><div class="checklist-check">'+(p.complete?'‚úì':'')+'</div><div class="checklist-content"><div class="checklist-title">'+p.icon+' '+p.name+'</div><div class="checklist-desc">'+p.summary+'</div></div><div style="text-align:right"><div style="font-size:20px;font-weight:700;color:var(--green-400);font-family:JetBrains Mono">'+formatCurrency(p.calculatedSavings)+'</div><button class="btn btn-secondary" style="padding:8px 12px;font-size:12px;margin-top:8px" onclick="event.stopPropagation();showStrategy(\''+p.id+'\')">View Steps</button></div></div>').join('')+'</div>';
}

function togglePlay(id){const idx=STATE.completedPlays.indexOf(id);if(idx>-1){STATE.completedPlays.splice(idx,1)}else{STATE.completedPlays.push(id)}saveState();renderPage('playbook');updateUI()}

function exportPlaybook(){const{jsPDF}=window.jspdf;const doc=new jsPDF();const plays=generatePlaybook();doc.setFontSize(24);doc.setTextColor(45,212,191);doc.text('DepreciationIQ',20,25);doc.setFontSize(16);doc.setTextColor(0);doc.text('Your Tax Savings Playbook',20,40);let y=60;plays.forEach((p,i)=>{doc.setFontSize(12);doc.text((i+1)+'. '+p.name+' - '+formatCurrency(p.calculatedSavings),20,y);y+=10});doc.save('DepreciationIQ_Playbook.pdf');toast('Exported!')}

// STRATEGIES
function renderStrategies(c){
    const filtered=STATE.strategyLevel==='all'?STRATEGIES:STRATEGIES.filter(s=>s.level===STATE.strategyLevel);
    c.innerHTML='<div class="page-header"><div><h1 class="page-title">Strategy Library</h1><p class="page-subtitle">16 proven tactics</p></div></div><div class="level-tabs"><div class="level-tab '+(STATE.strategyLevel==='all'?'active':'')+'" onclick="filterStrategies(\'all\')">All</div><div class="level-tab '+(STATE.strategyLevel==='starter'?'active':'')+'" onclick="filterStrategies(\'starter\')">Starter</div><div class="level-tab '+(STATE.strategyLevel==='growth'?'active':'')+'" onclick="filterStrategies(\'growth\')">Growth</div><div class="level-tab '+(STATE.strategyLevel==='wealth'?'active':'')+'" onclick="filterStrategies(\'wealth\')">Wealth</div><div class="level-tab '+(STATE.strategyLevel==='elite'?'active':'')+'" onclick="filterStrategies(\'elite\')">Elite</div></div><div class="strategy-grid">'+filtered.map(s=>'<div class="strategy-card" onclick="showStrategy(\''+s.id+'\')"><span class="strategy-level '+s.level+'">'+s.level+'</span><div class="strategy-icon">'+s.icon+'</div><div class="strategy-name">'+s.name+'</div><div class="strategy-savings">Save '+formatCurrency(s.savings(STATE.profile))+'</div><div class="strategy-desc">'+s.summary+'</div></div>').join('')+'</div>';
}

function filterStrategies(level){STATE.strategyLevel=level;renderPage('strategies')}

function showStrategy(id){
    const s=STRATEGIES.find(x=>x.id===id);if(!s)return;
    document.getElementById('strategyModalTitle').innerHTML=s.icon+' '+s.name;
    document.getElementById('strategyModalBody').innerHTML='<div style="display:flex;gap:12px;margin-bottom:24px;flex-wrap:wrap"><span style="background:rgba(34,197,94,0.15);color:var(--green-400);padding:8px 16px;border-radius:8px;font-weight:600">üí∞ Save '+formatCurrency(s.savings(STATE.profile))+'</span><span style="background:var(--navy-700);padding:8px 16px;border-radius:8px;text-transform:uppercase;font-size:12px;font-weight:700">'+s.level+'</span></div><div class="detail-section"><h3 class="detail-section-title">Overview</h3><p>'+s.summary+'</p></div><div class="detail-section"><h3 class="detail-section-title">Implementation Steps</h3><ul>'+s.steps.map(step=>'<li>'+step+'</li>').join('')+'</ul></div>'+(s.vehicles?'<div class="detail-section"><h3 class="detail-section-title">Qualifying Vehicles</h3><p>'+s.vehicles.join(' ‚Ä¢ ')+'</p></div>':'')+(s.jobs?'<div class="detail-section"><h3 class="detail-section-title">Legitimate Jobs</h3><p>'+s.jobs.join(' ‚Ä¢ ')+'</p></div>':'')+(s.warning?'<div style="background:rgba(239,68,68,0.1);border:1px solid var(--red-400);border-radius:12px;padding:16px;margin:20px 0"><strong style="color:var(--red-400)">‚ö†Ô∏è Warning:</strong> '+s.warning+'</div>':'')+(s.questions?'<div class="detail-section"><h3 class="detail-section-title">Ask Your CPA</h3><ul>'+s.questions.map(q=>'<li>'+q+'</li>').join('')+'</ul></div>':'');
    document.getElementById('strategyModal').classList.add('active');
}

// ASSETS
function renderAssets(c){
    c.innerHTML='<div class="page-header"><div><h1 class="page-title">Asset Vault</h1></div><button class="btn btn-primary" onclick="openAssetModal()">+ Add Asset</button></div><div class="card"><div class="card-body" style="padding:0">'+(STATE.assets.length===0?'<div class="empty-state"><div class="empty-state-icon">üì¶</div><h3>No assets yet</h3><p>Add your first asset</p><button class="btn btn-primary" onclick="openAssetModal()">+ Add Asset</button></div>':STATE.assets.map(a=>assetRow(a)).join(''))+'</div></div>';
}

function assetRow(a){const icons={vehicle:'üöó',equipment:'üíª',furniture:'ü™ë',realestate:'üè†',other:'üì¶'};const basis=a.price*a.business/100;const pct=Math.min(100,(Math.max(1,new Date().getFullYear()-new Date(a.date).getFullYear()+1)/(a.period||7))*100);return'<div class="asset-row" onclick="openAssetModal(\''+a.id+'\')"><div class="asset-info"><div class="asset-icon">'+(icons[a.type]||'üì¶')+'</div><div><div class="asset-name">'+a.name+'</div><div class="asset-type">'+a.type+'</div></div></div><div class="asset-value">'+formatCurrency(basis)+'</div><div><div class="dep-bar"><div class="dep-fill" style="width:'+pct+'%"></div></div></div><div><span class="status-badge '+a.status+'">'+a.status+'</span></div></div>'}

let editAssetId=null;
function openAssetModal(id){editAssetId=id||null;document.getElementById('assetForm').reset();document.getElementById('assetDate').value=new Date().toISOString().split('T')[0];if(id){const a=STATE.assets.find(x=>x.id===id);if(a){document.getElementById('assetModalTitle').textContent='Edit Asset';document.getElementById('deleteAssetBtn').style.display='block';document.getElementById('assetType').value=a.type;document.getElementById('assetStatus').value=a.status;document.getElementById('assetName').value=a.name;document.getElementById('assetDate').value=a.date;document.getElementById('assetPrice').value=a.price;document.getElementById('assetBusiness').value=a.business;document.getElementById('assetPeriod').value=a.period}}else{document.getElementById('assetModalTitle').textContent='Add Asset';document.getElementById('deleteAssetBtn').style.display='none'}document.getElementById('assetModal').classList.add('active')}

function saveAsset(){const f=document.getElementById('assetForm');if(!f.checkValidity()){f.reportValidity();return}const data={id:editAssetId||Date.now().toString(),type:document.getElementById('assetType').value,status:document.getElementById('assetStatus').value,name:document.getElementById('assetName').value,date:document.getElementById('assetDate').value,price:parseFloat(document.getElementById('assetPrice').value),business:parseFloat(document.getElementById('assetBusiness').value)||100,period:parseFloat(document.getElementById('assetPeriod').value)||7};if(editAssetId){const idx=STATE.assets.findIndex(a=>a.id===editAssetId);if(idx>-1)STATE.assets[idx]=data;toast('Updated')}else{STATE.assets.push(data);toast('Added')}saveState();closeModal('assetModal');renderPage(STATE.page)}

function deleteAsset(){if(editAssetId){STATE.assets=STATE.assets.filter(a=>a.id!==editAssetId);saveState();toast('Deleted')}closeModal('assetModal');renderPage(STATE.page)}

// RECEIPTS
function renderReceipts(c){
    c.innerHTML='<div class="page-header"><div><h1 class="page-title">Receipts</h1></div><button class="btn btn-primary" onclick="openReceiptModal()">+ Add Receipt</button></div><div class="upload-zone" onclick="openReceiptModal()"><div class="upload-icon">üìÑ</div><div class="upload-title">Drop receipts here or click to add</div><div class="upload-subtitle">Supports images and PDFs</div></div>'+(STATE.receipts.length>0?'<div class="receipt-list" style="margin-top:24px">'+STATE.receipts.map(r=>'<div class="receipt-item"><div class="receipt-icon">üßæ</div><div class="receipt-info"><div class="receipt-name">'+r.vendor+'</div><div class="receipt-meta">'+r.date+' ‚Ä¢ '+r.category+'</div></div><div class="receipt-amount">'+formatCurrency(r.amount)+'</div></div>').join('')+'</div>':'');
}

function openReceiptModal(){document.getElementById('receiptForm').reset();document.getElementById('receiptDate').value=new Date().toISOString().split('T')[0];document.getElementById('receiptModal').classList.add('active')}

function saveReceipt(){const f=document.getElementById('receiptForm');if(!f.checkValidity()){f.reportValidity();return}STATE.receipts.push({id:Date.now().toString(),vendor:document.getElementById('receiptVendor').value,date:document.getElementById('receiptDate').value,amount:parseFloat(document.getElementById('receiptAmount').value),category:document.getElementById('receiptCategory').value,notes:document.getElementById('receiptNotes').value});saveState();closeModal('receiptModal');renderPage('receipts');toast('Receipt added')}

// CALCULATORS
function renderSCorpCalc(c){c.innerHTML='<div class="page-header"><div><h1 class="page-title">S-Corp Optimizer</h1></div></div><div class="calc-layout"><div class="calc-form"><h3 class="calc-title">üè¢ Your Numbers</h3><div class="calc-grid"><div class="form-group full"><label class="form-label">Net Profit ($)</label><input type="number" class="form-input" id="scorpProfit" value="'+(STATE.profile.income||150000)+'" oninput="calcSCorp()"></div><div class="form-group"><label class="form-label">Reasonable Salary ($)</label><input type="number" class="form-input" id="scorpSalary" value="'+Math.round((STATE.profile.income||150000)*0.45)+'" oninput="calcSCorp()"></div><div class="form-group"><label class="form-label">Tax Bracket</label><select class="form-select" id="scorpBracket" onchange="calcSCorp()"><option value="0.22">22%</option><option value="0.24" selected>24%</option><option value="0.32">32%</option><option value="0.35">35%</option></select></div></div></div><div class="calc-results"><h3 class="calc-title">üìä Results</h3><div id="scorpResults"></div></div></div>';calcSCorp()}

function calcSCorp(){const profit=parseFloat(document.getElementById('scorpProfit')?.value)||150000;const salary=parseFloat(document.getElementById('scorpSalary')?.value)||70000;const without_=profit*0.9235*0.153;const with_=salary*0.153;const dist=profit-salary;const savings=without_-with_;document.getElementById('scorpResults').innerHTML='<div class="result-item"><div class="result-label">Without S-Corp (SE Tax)</div><div class="result-value">'+formatCurrency(without_)+'</div></div><div class="result-item"><div class="result-label">With S-Corp (Payroll Tax)</div><div class="result-value teal">'+formatCurrency(with_)+'</div></div><div class="result-item"><div class="result-label">Tax-Free Distribution</div><div class="result-value">'+formatCurrency(dist)+'</div></div><div class="result-item"><div class="result-label">Annual Savings</div><div class="result-value green">'+formatCurrency(savings)+'</div></div>'}

function renderVehicleCalc(c){c.innerHTML='<div class="page-header"><div><h1 class="page-title">Heavy Vehicle Calculator</h1></div></div><div class="calc-layout"><div class="calc-form"><h3 class="calc-title">üöõ Vehicle Details</h3><div class="calc-grid"><div class="form-group"><label class="form-label">Vehicle Type</label><select class="form-select" id="vehType" onchange="calcVehicle()"><option value="car">Under 6,000 lbs</option><option value="heavy" selected>Over 6,000 lbs</option></select></div><div class="form-group"><label class="form-label">Price ($)</label><input type="number" class="form-input" id="vehPrice" value="75000" oninput="calcVehicle()"></div><div class="form-group"><label class="form-label">Business %</label><input type="number" class="form-input" id="vehBusiness" value="100" oninput="calcVehicle()"></div><div class="form-group"><label class="form-label">Tax Bracket</label><select class="form-select" id="vehBracket" onchange="calcVehicle()"><option value="0.24" selected>24%</option><option value="0.32">32%</option><option value="0.35">35%</option></select></div></div><div class="info-box"><div class="info-box-title">üöõ Qualifying Vehicles</div><p>F-150, Silverado, Tahoe, Expedition, Escalade, G-Wagon, Range Rover</p></div></div><div class="calc-results"><h3 class="calc-title">üìä Results</h3><div id="vehResults"></div></div></div>';calcVehicle()}

function calcVehicle(){const type=document.getElementById('vehType')?.value||'heavy';const price=parseFloat(document.getElementById('vehPrice')?.value)||75000;const business=(parseFloat(document.getElementById('vehBusiness')?.value)||100)/100;const bracket=parseFloat(document.getElementById('vehBracket')?.value)||0.24;const basis=price*business;let y1;if(type==='heavy'){const s179=Math.min(basis,30500);y1=s179+(basis-s179)*0.60}else{y1=Math.min(basis,20200)}const savings=y1*bracket;document.getElementById('vehResults').innerHTML='<div class="result-item"><div class="result-label">Year 1 Deduction</div><div class="result-value teal">'+formatCurrency(y1)+'</div></div><div class="result-item"><div class="result-label">Tax Savings</div><div class="result-value green">'+formatCurrency(savings)+'</div></div><div class="result-item"><div class="result-label">Effective Cost</div><div class="result-value">'+formatCurrency(price-savings)+'</div></div>'+(type==='heavy'?'<div style="background:var(--teal-glow);border-radius:12px;padding:16px;margin-top:16px;text-align:center;color:var(--teal-400);font-weight:600">‚úì Heavy Vehicle Qualified!</div>':'')}

function render401kCalc(c){c.innerHTML='<div class="page-header"><div><h1 class="page-title">Solo 401(k) Calculator</h1></div></div><div class="calc-layout"><div class="calc-form"><h3 class="calc-title">üè¶ Your Details</h3><div class="calc-grid"><div class="form-group full"><label class="form-label">Net SE Income ($)</label><input type="number" class="form-input" id="k401Income" value="'+(STATE.profile.income||150000)+'" oninput="calc401k()"></div><div class="form-group"><label class="form-label">Age</label><select class="form-select" id="k401Age" onchange="calc401k()"><option value="under50" '+(STATE.profile.age<50?'selected':'')+'>Under 50</option><option value="over50" '+(STATE.profile.age>=50?'selected':'')+'>50+</option></select></div><div class="form-group"><label class="form-label">Tax Bracket</label><select class="form-select" id="k401Bracket" onchange="calc401k()"><option value="0.24" selected>24%</option><option value="0.32">32%</option><option value="0.35">35%</option></select></div></div></div><div class="calc-results"><h3 class="calc-title">üìä Results</h3><div id="k401Results"></div></div></div>';calc401k()}

function calc401k(){const income=parseFloat(document.getElementById('k401Income')?.value)||150000;const isOver50=document.getElementById('k401Age')?.value==='over50';const bracket=parseFloat(document.getElementById('k401Bracket')?.value)||0.24;const employee=isOver50?30500:23000;const employer=Math.min(income*0.9235*0.20,69000-employee);const total=employee+employer;const savings=total*bracket;document.getElementById('k401Results').innerHTML='<div class="result-item"><div class="result-label">Employee Contribution</div><div class="result-value">'+formatCurrency(employee)+'</div></div><div class="result-item"><div class="result-label">Employer Contribution</div><div class="result-value">'+formatCurrency(employer)+'</div></div><div class="result-item"><div class="result-label">Total Contribution</div><div class="result-value teal">'+formatCurrency(total)+'</div></div><div class="result-item"><div class="result-label">Tax Savings</div><div class="result-value green">'+formatCurrency(savings)+'</div></div>'}

function renderHireKidsCalc(c){c.innerHTML='<div class="page-header"><div><h1 class="page-title">Hire Your Kids</h1></div></div><div class="calc-layout"><div class="calc-form"><h3 class="calc-title">üë®‚Äçüëß Details</h3><div class="calc-grid"><div class="form-group"><label class="form-label"># of Children</label><select class="form-select" id="kidsCount" onchange="calcKids()"><option value="1">1</option><option value="2">2</option><option value="3">3</option></select></div><div class="form-group"><label class="form-label">Pay Per Child ($)</label><input type="number" class="form-input" id="kidsPay" value="14600" oninput="calcKids()"></div><div class="form-group"><label class="form-label">Your Bracket</label><select class="form-select" id="kidsBracket" onchange="calcKids()"><option value="0.24" selected>24%</option><option value="0.32">32%</option><option value="0.35">35%</option></select></div><div class="form-group"><label class="form-label">Entity</label><select class="form-select" id="kidsEntity" onchange="calcKids()"><option value="sole">Sole Prop</option><option value="corp">S-Corp</option></select></div></div><div class="info-box"><div class="info-box-title">üí° Legitimate Jobs</div><p>Cleaning, filing, social media, data entry, photo/video</p></div></div><div class="calc-results"><h3 class="calc-title">üìä Results</h3><div id="kidsResults"></div></div></div>';calcKids()}

function calcKids(){const count=parseInt(document.getElementById('kidsCount')?.value)||1;const pay=parseFloat(document.getElementById('kidsPay')?.value)||14600;const bracket=parseFloat(document.getElementById('kidsBracket')?.value)||0.24;const isSole=document.getElementById('kidsEntity')?.value==='sole';const total=pay*count;const incomeSaved=total*bracket;const ficaSaved=isSole?total*0.153:0;const totalSaved=incomeSaved+ficaSaved;document.getElementById('kidsResults').innerHTML='<div class="result-item"><div class="result-label">Total Paid</div><div class="result-value">'+formatCurrency(total)+'</div></div><div class="result-item"><div class="result-label">Your Deduction</div><div class="result-value teal">'+formatCurrency(total)+'</div></div><div class="result-item"><div class="result-label">Income Tax Saved</div><div class="result-value">'+formatCurrency(incomeSaved)+'</div></div>'+(isSole?'<div class="result-item"><div class="result-label">FICA Saved</div><div class="result-value">'+formatCurrency(ficaSaved)+'</div></div>':'')+'<div class="result-item"><div class="result-label">Total Benefit</div><div class="result-value green">'+formatCurrency(totalSaved)+'</div></div><div class="result-item"><div class="result-label">Kids Tax</div><div class="result-value" style="color:var(--teal-400)">$0</div></div>'}

// AI ADVISOR
function renderAIAdvisor(c){c.innerHTML='<div class="page-header"><div><h1 class="page-title">AI Wealth Advisor</h1></div></div><div class="chat-container"><div class="chat-messages" id="chatMessages">'+(STATE.chatHistory.length===0?'<div class="chat-message assistant"><div class="chat-avatar">ü§ñ</div><div class="chat-bubble">üëã Hi! I can help you with:<br><br>‚Ä¢ <strong>S-Corp</strong> - Save on SE tax<br>‚Ä¢ <strong>Solo 401(k)</strong> - Shelter $69K/year<br>‚Ä¢ <strong>Heavy vehicle</strong> - $50K+ deduction<br>‚Ä¢ <strong>Hire kids</strong> - Tax-free shifting<br>‚Ä¢ <strong>Buy, Borrow, Die</strong> - Billionaire strategy<br><br>Ask "what should I do?" for personalized recommendations.</div></div>':STATE.chatHistory.map(m=>'<div class="chat-message '+m.role+'"><div class="chat-avatar">'+(m.role==='user'?(STATE.user?.name?.charAt(0)||'U'):'ü§ñ')+'</div><div class="chat-bubble">'+m.content+'</div></div>').join(''))+'</div><div class="chat-input-area"><textarea class="chat-input" id="chatInput" placeholder="Ask about tax strategies..." rows="1" onkeydown="if(event.key===\'Enter\'&&!event.shiftKey){event.preventDefault();sendChat()}"></textarea><button class="btn btn-primary" onclick="sendChat()">Send</button></div></div>'}

function sendChat(){const input=document.getElementById('chatInput');const msg=input.value.trim();if(!msg)return;input.value='';STATE.chatHistory.push({role:'user',content:msg});saveState();const messages=document.getElementById('chatMessages');messages.innerHTML+='<div class="chat-message user"><div class="chat-avatar">'+(STATE.user?.name?.charAt(0)||'U')+'</div><div class="chat-bubble">'+msg+'</div></div>';messages.scrollTop=messages.scrollHeight;setTimeout(()=>{const response=getAIResponse(msg);STATE.chatHistory.push({role:'assistant',content:response});saveState();messages.innerHTML+='<div class="chat-message assistant"><div class="chat-avatar">ü§ñ</div><div class="chat-bubble">'+response+'</div></div>';messages.scrollTop=messages.scrollHeight},500)}

function getAIResponse(msg){const lower=msg.toLowerCase();const income=STATE.profile.income;const bracket=getTaxBracket(income);
if(lower.includes('s-corp')||lower.includes('s corp'))return'<strong>S-Corp Election</strong><br><br>Based on your '+formatCurrency(income)+' income:<br><br>‚Ä¢ SE Tax without: '+formatCurrency(income*0.9235*0.153)+'<br>‚Ä¢ Salary (50%): '+formatCurrency(income*0.5)+'<br>‚Ä¢ SE Tax with: '+formatCurrency(income*0.5*0.153)+'<br>‚Ä¢ <strong>Savings: '+formatCurrency(income*0.5*0.153)+'</strong>';
if(lower.includes('vehicle')||lower.includes('truck'))return'<strong>Heavy Vehicle Strategy</strong><br><br>Vehicles over 6,000 lbs:<br><br>‚Ä¢ Section 179: $30,500<br>‚Ä¢ Bonus (60%): $26,700<br>‚Ä¢ <strong>Year 1: $57,200</strong><br>‚Ä¢ Savings: '+formatCurrency(57200*bracket)+'<br><br>Qualifying: F-150, Tahoe, Escalade, G-Wagon';
if(lower.includes('401k')||lower.includes('retirement'))return'<strong>Solo 401(k)</strong><br><br>‚Ä¢ Employee: $23,000<br>‚Ä¢ Employer (25%): '+formatCurrency(Math.min(income*0.25,46000))+'<br>‚Ä¢ <strong>Total: '+formatCurrency(Math.min(69000,23000+income*0.25))+'</strong><br>‚Ä¢ Savings: '+formatCurrency(Math.min(69000,23000+income*0.25)*bracket);
if(lower.includes('kid')||lower.includes('child'))return'<strong>Hire Your Kids</strong><br><br>Pay up to $14,600/child = $0 tax for them.<br><br>Your benefit:<br>‚Ä¢ Deduction: $14,600<br>‚Ä¢ Tax Savings: '+formatCurrency(14600*bracket)+'<br>‚Ä¢ FICA Saved: $2,230<br>‚Ä¢ <strong>Total: '+formatCurrency(14600*bracket+2230)+'</strong>';
if(lower.includes('buy')||lower.includes('borrow')||lower.includes('die'))return'<strong>Buy, Borrow, Die</strong><br><br>How billionaires pay $0:<br><br>1. Buy assets<br>2. Never sell (no gains)<br>3. Borrow against them<br>4. Die with step-up<br><br>Result: $0 tax ever.';
if(lower.includes('best')||lower.includes('recommend')||lower.includes('should')){const plays=generatePlaybook();return'Based on your profile:<br><br>'+plays.slice(0,5).map((p,i)=>(i+1)+'. <strong>'+p.name+'</strong> - '+formatCurrency(p.calculatedSavings)).join('<br>')+'<br><br><strong>Total: '+formatCurrency(plays.reduce((s,p)=>s+p.calculatedSavings,0))+'</strong>'}
return'I can help with: S-Corp, Solo 401(k), heavy vehicle, hire kids, or billionaire strategies. Ask "what should I do?" for recommendations.'}

// INTEGRATIONS
function renderIntegrations(c){c.innerHTML='<div class="page-header"><div><h1 class="page-title">Integrations</h1></div></div><div class="integration-grid"><div class="integration-card" onclick="connectIntegration(\'quickbooks\')"><div class="integration-icon">üìó</div><div class="integration-name">QuickBooks</div><div class="integration-status">Click to connect</div></div><div class="integration-card" onclick="connectIntegration(\'xero\')"><div class="integration-icon">üìò</div><div class="integration-name">Xero</div><div class="integration-status">Click to connect</div></div><div class="integration-card" onclick="connectIntegration(\'wave\')"><div class="integration-icon">üåä</div><div class="integration-name">Wave</div><div class="integration-status">Click to connect</div></div><div class="integration-card" onclick="connectIntegration(\'plaid\')"><div class="integration-icon">üè¶</div><div class="integration-name">Bank (Plaid)</div><div class="integration-status">Click to connect</div></div><div class="integration-card" onclick="connectIntegration(\'stripe\')"><div class="integration-icon">üí≥</div><div class="integration-name">Stripe</div><div class="integration-status">Click to connect</div></div><div class="integration-card" onclick="connectIntegration(\'square\')"><div class="integration-icon">‚¨ú</div><div class="integration-name">Square</div><div class="integration-status">Click to connect</div></div></div><div class="info-box" style="margin-top:24px"><div class="info-box-title">üîå Coming Soon</div><p>Connect your accounting software to automatically import transactions and sync assets.</p></div>'}

function connectIntegration(name){toast(name+' integration coming soon!')}

// SETTINGS
function renderSettings(c){c.innerHTML='<div class="page-header"><div><h1 class="page-title">Settings</h1></div></div><div class="card"><div class="card-header"><h3 class="card-title">Profile</h3></div><div class="card-body"><div class="form-row"><div class="form-group"><label class="form-label">Annual Income</label><input type="number" class="form-input" id="setIncome" value="'+STATE.profile.income+'" onchange="updateProfile()"></div><div class="form-group"><label class="form-label">Entity Type</label><select class="form-select" id="setEntity" onchange="updateProfile()"><option value="sole" '+(STATE.profile.entity==='sole'?'selected':'')+'>Sole Proprietor</option><option value="llc" '+(STATE.profile.entity==='llc'?'selected':'')+'>LLC</option><option value="scorp" '+(STATE.profile.entity==='scorp'?'selected':'')+'>S-Corp</option></select></div></div><div class="form-row"><div class="form-group"><label class="form-label">Age</label><input type="number" class="form-input" id="setAge" value="'+STATE.profile.age+'" onchange="updateProfile()"></div><div class="form-group"><label class="form-label">Kids (ages)</label><input type="text" class="form-input" id="setKids" value="'+(STATE.profile.kids?.map(k=>k.age).join(', ')||'')+'" onchange="updateProfile()"></div></div><button class="btn btn-primary" onclick="updateProfile();toast(\'Saved\')">Save Changes</button></div></div><div class="card" style="margin-top:24px"><div class="card-header"><h3 class="card-title">Data</h3></div><div class="card-body"><button class="btn btn-secondary" onclick="exportData()">üì• Export JSON</button><button class="btn btn-secondary" style="margin-left:12px;background:var(--red-500)" onclick="if(confirm(\'Delete all data?\')){localStorage.clear();location.reload()}">üóëÔ∏è Reset</button></div></div>'}

function updateProfile(){STATE.profile.income=parseInt(document.getElementById('setIncome')?.value)||0;STATE.profile.entity=document.getElementById('setEntity')?.value||'sole';STATE.profile.age=parseInt(document.getElementById('setAge')?.value)||35;const ages=document.getElementById('setKids')?.value.split(',').map(a=>parseInt(a.trim())).filter(a=>a>0)||[];STATE.profile.kids=ages.map(age=>({age}));saveState();updateUI()}

function exportData(){const blob=new Blob([JSON.stringify(STATE,null,2)],{type:'application/json'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='depreciationiq.json';a.click();toast('Exported')}

// START
init();
</script>
</body>
</html>
